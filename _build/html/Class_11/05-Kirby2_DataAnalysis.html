

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>5: Abs vs Time Data Analysis &#8212; Chem 4410 Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tufte.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Class_11/05-Kirby2_DataAnalysis';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6: pH-Rate Data Analysis" href="06-Kirby2_DataAnalysis.html" />
    <link rel="prev" title="4: Numeric Integration" href="04-Kirby2_PlotEqsFromPaper.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../start.html">
  
  
  
  
  
  
    <p class="title logo__title">Chem 4410 Python</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../start.html">
                    Chem 4410 Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Thermochemistry</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Class_05/Group_Increments_Class_Handout_Discussion-Problem1.html">Group Increments Handout Discussion - Problem 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_05/Group_Increments_Class_Handout_Discussion-Problem5.html">Group Increments Handout Discussion - Problems 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_05/Group_Increments_Class_Handout_Discussion-Problems2to4.html">Group Increments - Handout Discussion - Problems 2 to 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_05/Group_Increments_ClassExercises.html">Group Increments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_06/AValueClasshandoutDiscussion.html">07 Handout A-Value Calculations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Acid and Bases</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Class_08/Correlations.html">Plotting Related <span class="math notranslate nohighlight">\(pK_a\)</span> Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_08/CurveSmoothAndInterpolate.html">Data Smoothing and Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_08/H0_Data.html">Acidity Function Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_08/HNO3_Acidity_Function_Calcs.html">Lesson #3, Meeting #8, Class Problem #1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_08/HNO3_Acidity_Function.html">HNO<sub>3</sub> Acidity Function Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_08/LookAheadToKinetics.html">A Look Ahead to Kinetics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_08/Question5_13.html">Chapter 5, Question 13</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Aspirin Hydrolysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Class_10/aspirin_notebook_with_uncertainty.html">Aspirin Hydrolysis Curve Fits</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Kirby Enzyme Models</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01-Kirby2_PlotEqsFromPaper.html">1: The Literature Equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-Kirby2_PlotEqsFromPaper.html">2: The Correct Equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-Kirby2_PlotEqsFromPaper.html">3: Integrating the Rate Laws</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-Kirby2_PlotEqsFromPaper.html">4: Numeric Integration</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">5: Abs vs Time Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-Kirby2_DataAnalysis.html">6: pH-Rate Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="04X-Kirby2_PlotEqsFromPaper.html">X: Creating Data Sets</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extras</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Class_09/CatenaryCurve.html">The Hammond Postulate and Rope</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/blinkletter/4410PythonNotebooks/blob/main/./Class_11/05-Kirby2_DataAnalysis.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/blinkletter/4410PythonNotebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Class_11/05-Kirby2_DataAnalysis.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>5: Abs vs Time Data Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2-part-5-ph-rate-profile-example-kirby-2002">Example 2, Part 5: pH-Rate Profile Example - Kirby 2002</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-equations">The equations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-data">Plot the Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#many-plots">Many Plots</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#curve-fit-to-1st-order">Curve Fit to 1st Order</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#curve-fitting-the-model">Curve Fitting the Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-same-thing-again-again">The Same Thing Again &amp; Again</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-ph-rate-profile">The pH-rate profile</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-the-wrong-equation">Extra: The Wrong Equation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiplot">Multiplot</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="abs-vs-time-data-analysis">
<h1>5: Abs vs Time Data Analysis<a class="headerlink" href="#abs-vs-time-data-analysis" title="Permalink to this heading">#</a></h1>
<section id="example-2-part-5-ph-rate-profile-example-kirby-2002">
<h2>Example 2, Part 5: pH-Rate Profile Example - Kirby 2002<a class="headerlink" href="#example-2-part-5-ph-rate-profile-example-kirby-2002" title="Permalink to this heading">#</a></h2>
<p>Tony Kirby is one of the giants of physical organic and bio-organic chemistry. In this paper he follows up on a decades-long series of papers investigating the mechanism of <em>amylases</em> that catalyze the hydrolysis of acetal groups in polysaccharide chains.</p>
<p>``Concerted general acid and nucleophilic catalysis of acetalhydrolysis. A simple model for the lysozyme mechanism’’. K.E.S. Deana, A.J. Kirby, <em>J. Chem. Soc., Perkin Trans. 2</em>, <strong>2002</strong>, 428-432. https://doi.org/10.1039/B110948K.</p>
<p>This <em>Python</em> notebook will curve fit the equation for absorbance vs time against kinetic data. We have a set of absorbance measured over 13 hours for 19 reaction performed at various pH values. We want to plot the pH rate profile (<span class="math notranslate nohighlight">\(\log{k_{obs}}\)</span> vs pH). First we must determine the rate constant. In this case there are <strong>two rate constants</strong> for two different reactions that produce product.</p>
</section>
<section id="the-equations">
<h2>The equations<a class="headerlink" href="#the-equations" title="Permalink to this heading">#</a></h2>
<p>For our reaction system…</p>
<div class="math notranslate nohighlight">
\[\text{A} \overset{k_1}{\longrightarrow} \text{I} + \text{P}\]</div>
<div class="math notranslate nohighlight">
\[\text{I} \overset{k_2}{\longrightarrow} \text{P}\]</div>
<p>…we state the following differential equations that describe the rate laws…</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
\dfrac{d\left[A\right]_t}{dt} &amp;= -k_1 \left[A\right]_t \\
\dfrac{d\left[I\right]_t}{dt} &amp;= k_1 \left[A\right]_t - k_2 \left[I\right]_t \\
\dfrac{d\left[P\right]_t}{dt} &amp;= k_1 \left[A\right]_t + k_2 \left[I\right]_t
\end{align*}
\end{split}\]</div>
<p>From this we derived the integrated rate laws and created equations that describe the concentration of each species w.r.t. time.</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}
\begin{align*}\\\begin{split}\left[A\right]_t &amp;= \left[A\right]_0 e^{-kt} \\
\left[I \right]_t &amp;= \left[A\right]_{0} \frac{ k_{1} }{k_{1} - k_{2}}\left(e^{- k_{2} t} - e^{- k_{1} t}\right) \\
\left[ P\right]_{t} &amp;= \left[A\right]_{0} \left[ 2 - 2 e^{- k_{1} t} - \frac{ k_{1} }{k_{1} - k_{2}}\left(e^{- k_{2} t} - e^{- k_{1} t}\right)\right] \\\end{split}\\\end{align*}
\end{aligned}\end{align} \]</div>
<p>And we can obtain the absorbance contribution from each species using the initial absorbance (<span class="math notranslate nohighlight">\(Abs_0\)</span>) and the molar extinction coefficients for each species (<span class="math notranslate nohighlight">\(\epsilon_A\)</span>, <span class="math notranslate nohighlight">\(\epsilon_I\)</span>, and <span class="math notranslate nohighlight">\(\epsilon_P\)</span>)</p>
<div class="math notranslate nohighlight">
\[\text{Abs}_t = \text{Abs}_0 \left\{ e^{-k_1 t}
             + \frac{\epsilon_I}{\epsilon_A} \frac{k_1}{k_2-k_1}\left(e^{-k_1 t} - e^{-k_2 t} \right)
             + \frac{\epsilon_P}{\epsilon_A} \left[ 2 - 2 e^{-k_1 t} - \frac{k_1}{k_2-k_1}\left(e^{-k_1 t} - e^{-k_2 t}\right) \right] \right\}\]</div>
<p>This is the model to which we will fit the data. Beware! The equation reported in the paper contains typographical errors. The above equation is correct.</p>
</section>
<section id="the-data">
<h2>The Data<a class="headerlink" href="#the-data" title="Permalink to this heading">#</a></h2>
<p>The data is collected in a single csv file. We can open that file with a text editor, observe its format, and then write python code to import the data into a <em>Pandas</em> dataframe. The code below will import the data and display the dataframe.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#######################</span>
<span class="c1">### Environment Setup and Global Variables</span>
<span class="c1">#######################</span>

<span class="n">github</span> <span class="o">=</span> <span class="kc">True</span>

<span class="o">!</span>mkdir<span class="w"> </span>data
<span class="o">!</span>mkdir<span class="w"> </span>plots
<span class="o">!</span>mkdir<span class="w"> </span>plots/stacking
<span class="o">!</span>mkdir<span class="w"> </span>plots/fits
<span class="o">!</span>mkdir<span class="w"> </span>plots/single

<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>uncertainties
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>lmfit

<span class="k">if</span> <span class="n">github</span><span class="p">:</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/blinkletter/4410PythonNotebooks/main/Class_11/data/&quot;</span>
    <span class="n">image_path</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/blinkletter/4410PythonNotebooks/main/Class_11/images/&quot;</span>
    <span class="n">github_data_location</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/blinkletter/LFER-QSAR/main/data/&quot;</span>
    <span class="n">github_styles_location</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/blinkletter/LFER-QSAR/main/styles/&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;../Class_11/data/&quot;</span>
    <span class="n">image_path</span> <span class="o">=</span> <span class="s2">&quot;../Class_11/images/&quot;</span>
    <span class="n">github_data_location</span> <span class="o">=</span> <span class="s2">&quot;/Users/blink/github/LFER-QSAR/data/&quot;</span>
    <span class="n">github_styles_location</span> <span class="o">=</span> <span class="s2">&quot;/Users/blink/github/LFER-QSAR/styles/&quot;</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mkdir: plots: File exists
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s2">&quot;Kirby2002/Abs_t_pH_ALL.csv&quot;</span><span class="p">,</span>
                <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span>
                <span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="n">time_column</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="c1"># get the column label for the first column (time)</span>
<span class="n">pH_values</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>     <span class="c1"># get the column labels that are the pH values</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time (hr)</th>
      <th>0.00</th>
      <th>0.28</th>
      <th>0.55</th>
      <th>1.00</th>
      <th>1.25</th>
      <th>1.50</th>
      <th>1.90</th>
      <th>2.25</th>
      <th>2.60</th>
      <th>3.40</th>
      <th>3.70</th>
      <th>4.10</th>
      <th>4.40</th>
      <th>4.75</th>
      <th>5.10</th>
      <th>5.60</th>
      <th>6.00</th>
      <th>6.50</th>
      <th>6.90</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.00</td>
      <td>0.2001</td>
      <td>0.2000</td>
      <td>0.2001</td>
      <td>0.2000</td>
      <td>0.2000</td>
      <td>0.1997</td>
      <td>0.1998</td>
      <td>0.2000</td>
      <td>0.2002</td>
      <td>0.2003</td>
      <td>0.1999</td>
      <td>0.1997</td>
      <td>0.2000</td>
      <td>0.2000</td>
      <td>0.1999</td>
      <td>0.2002</td>
      <td>0.1999</td>
      <td>0.2002</td>
      <td>0.2003</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.25</td>
      <td>0.1980</td>
      <td>0.1957</td>
      <td>0.1969</td>
      <td>0.1981</td>
      <td>0.1989</td>
      <td>0.1990</td>
      <td>0.1990</td>
      <td>0.1988</td>
      <td>0.1978</td>
      <td>0.1951</td>
      <td>0.1918</td>
      <td>0.1901</td>
      <td>0.1894</td>
      <td>0.1910</td>
      <td>0.1941</td>
      <td>0.1968</td>
      <td>0.1985</td>
      <td>0.1998</td>
      <td>0.1999</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.50</td>
      <td>0.2096</td>
      <td>0.1970</td>
      <td>0.1958</td>
      <td>0.1965</td>
      <td>0.1978</td>
      <td>0.1980</td>
      <td>0.1977</td>
      <td>0.1973</td>
      <td>0.1960</td>
      <td>0.1911</td>
      <td>0.1872</td>
      <td>0.1851</td>
      <td>0.1848</td>
      <td>0.1867</td>
      <td>0.1897</td>
      <td>0.1948</td>
      <td>0.1974</td>
      <td>0.1993</td>
      <td>0.1998</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.75</td>
      <td>0.2203</td>
      <td>0.2014</td>
      <td>0.1953</td>
      <td>0.1958</td>
      <td>0.1968</td>
      <td>0.1966</td>
      <td>0.1965</td>
      <td>0.1959</td>
      <td>0.1941</td>
      <td>0.1884</td>
      <td>0.1848</td>
      <td>0.1826</td>
      <td>0.1825</td>
      <td>0.1836</td>
      <td>0.1874</td>
      <td>0.1926</td>
      <td>0.1965</td>
      <td>0.1988</td>
      <td>0.1998</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.00</td>
      <td>0.2277</td>
      <td>0.2065</td>
      <td>0.1964</td>
      <td>0.1948</td>
      <td>0.1965</td>
      <td>0.1962</td>
      <td>0.1957</td>
      <td>0.1952</td>
      <td>0.1926</td>
      <td>0.1862</td>
      <td>0.1835</td>
      <td>0.1819</td>
      <td>0.1816</td>
      <td>0.1824</td>
      <td>0.1856</td>
      <td>0.1915</td>
      <td>0.1953</td>
      <td>0.1989</td>
      <td>0.1996</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="plot-the-data">
<h2>Plot the Data<a class="headerlink" href="#plot-the-data" title="Permalink to this heading">#</a></h2>
<p>Always do a quick visual check of your data. Perhaps its all noise? the code below will plot all the abs vs time traces in a single plot.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>                              <span class="c1">### resets the plot to defaults </span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>  

<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span>

<span class="k">for</span> <span class="n">pH</span> <span class="ow">in</span> <span class="n">pH_values</span><span class="p">:</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>             <span class="c1"># get absorbance values at a given pH</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>          <span class="c1"># draw a plot</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">markeredgewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> 
            <span class="n">markerfacecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">markeredgecolor</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>            <span class="c1">### use a line between points</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span>            <span class="c1">### make the line thin</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>            <span class="c1">### the line is black</span>
            <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span>                  <span class="c1">### everything is in layer 0 (the bottom layer in this case)</span>
            <span class="p">)</span>
    
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance\ /AU$&quot;</span><span class="p">,</span> 
        <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /\; hrs$&quot;</span><span class="p">,</span>
<span class="c1">#        title = &quot;Abs. vs time&quot;,</span>
        <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>      
        <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.175</span><span class="p">,</span> <span class="mf">0.245</span><span class="p">]</span>
   <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># otherwise the right y-label is slightly clipped</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/05_Kirby2_&quot;</span><span class="o">+</span><span class="s2">&quot;ALL&quot;</span><span class="o">+</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)</span>    <span class="c1"># use this to save the figure in PDF format</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/c35b2e4196b2f820a83f94085df1d084a6cedcc3cbcf532c75a843fcff21787d.png" src="../_images/c35b2e4196b2f820a83f94085df1d084a6cedcc3cbcf532c75a843fcff21787d.png" />
</div>
</div>
<section id="many-plots">
<h3>Many Plots<a class="headerlink" href="#many-plots" title="Permalink to this heading">#</a></h3>
<p>The code above placed all the lines in a single plot. Small changes can result in separate plots for each run. All that is changing is what commands are inside the loop or outside the loop. See if you can follow the differences and their effects.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>                              <span class="c1">### resets the plot to defaults </span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>  

<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span>

<span class="k">for</span> <span class="n">pH</span> <span class="ow">in</span> <span class="n">pH_values</span><span class="p">:</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>             <span class="c1"># get absorbance values at a given pH</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>          <span class="c1"># draw a plot</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">markeredgewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> 
            <span class="n">markerfacecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">markeredgecolor</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>            <span class="c1">### use a line between points</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span>            <span class="c1">### make the line thin</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>            <span class="c1">### the line is black</span>
            <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span>                  <span class="c1">### everything is in layer 0 (the bottom layer in this case)</span>
            <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance\ /AU$&quot;</span><span class="p">,</span> 
            <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /\; hrs$&quot;</span><span class="p">,</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Abs. vs time&quot;</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>      
            <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.175</span><span class="p">,</span> <span class="mf">0.245</span><span class="p">])</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># otherwise the right y-label is slightly clipped</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/stacking/05_Kirby2_Stacking_&quot;</span><span class="o">+</span><span class="n">pH</span><span class="o">+</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)</span>    <span class="c1"># use this to save the figure in PDF format</span>

<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>                              <span class="c1">### resets the plot to defaults </span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>


<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span>

<span class="k">for</span> <span class="n">pH</span> <span class="ow">in</span> <span class="n">pH_values</span><span class="p">:</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>             <span class="c1"># get absorbance values at a given pH</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>  

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>          <span class="c1"># draw a plot</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">markeredgewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> 
            <span class="n">markerfacecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">markeredgecolor</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>            <span class="c1">### use a line between points</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span>            <span class="c1">### make the line thin</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>            <span class="c1">### the line is black</span>
            <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span>                  <span class="c1">### everything is in layer 0 (the bottom layer in this case)</span>
            <span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">0.18</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;pH = </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance\ /AU$&quot;</span><span class="p">,</span> 
            <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /\; hrs$&quot;</span><span class="p">,</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Abs. vs time&quot;</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>      
            <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.175</span><span class="p">,</span> <span class="mf">0.245</span><span class="p">])</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># otherwise the right y-label is slightly clipped</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/single/05_Kirby2_Single_&quot;</span><span class="o">+</span><span class="n">pH</span><span class="o">+</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)</span>    <span class="c1"># use this to save the figure in PDF format</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>        <span class="c1"># close the plot and do not show it in the notebook</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="curve-fit-to-1st-order">
<h2>Curve Fit to 1st Order<a class="headerlink" href="#curve-fit-to-1st-order" title="Permalink to this heading">#</a></h2>
<p>Note: the authors inform us that only the very low pH runs fit a standard first-order integrated rate law. Let us model this anyway and see if that is what we observe.</p>
<p>The reaction could be considered to be a simple first order reaction that produces two products. This would be the case if <span class="math notranslate nohighlight">\(k_2 \gg k_1\)</span></p>
<p>So for The case…</p>
<div class="math notranslate nohighlight">
\[\text{A} \overset{k_{obs}}{\longrightarrow} 2 \text{P}\]</div>
<p>The absorbance change will be the addition of <span class="math notranslate nohighlight">\(Abs_A\)</span> and <span class="math notranslate nohighlight">\(Abs_P\)</span> and is derived as…</p>
<div class="math notranslate nohighlight">
\[\text{Abs}_t = \text{Abs}_0 \left\{ e^{-k_1 t}
             +2 \frac{\epsilon_P}{\epsilon_A} \left[ 1 -  e^{-k_1 t}  \right] \right\}\]</div>
<p>…which is the same as eq. 2 in the paper. Let us fit a set of experimental data to this equation. Consider the code below.</p>
<p>We can curve fit using the derived equation objects from sympy; we can curve fit using the numeric integration function; and we can curve fit a function that we create according to the know equation. this latter method is the simplest to code so that is what we will use.</p>
<p>It can be a problem to fit many variable. If there are variables that are strongly correlated we can end up with a situation where many very different solutions can give a satisfactory fit. We can also have systems that will not minimize as there is too large of a numerical space to explore in search of the minimum.</p>
<p>From previous work (one must go to a PhD thesis at Cambridge to get this data) we know that <span class="math notranslate nohighlight">\(\epsilon_P/\epsilon_A = 3.0\)</span> and we have deesigned the experiment in such a way that the initial concentrations of the reactant gives a value for <span class="math notranslate nohighlight">\(Abs_0 = 0.100 \)</span> AU. Now we only have to solve for <span class="math notranslate nohighlight">\(k_{obs}\)</span></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">lmfit</span>     
<span class="kn">import</span> <span class="nn">uncertainties</span> <span class="k">as</span> <span class="nn">un</span>               <span class="c1"># tool set for handling uncertainties</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="kn">import</span> <span class="n">unumpy</span> <span class="k">as</span> <span class="n">unp</span>  <span class="c1"># a replacement for numpy </span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="n">pH</span> <span class="o">=</span> <span class="n">pH_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>     <span class="c1"># choose one of the pH columns</span>
<span class="c1">#print(len(pH_values))</span>


<span class="k">def</span> <span class="nf">fit_u</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">):</span>

    <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
    <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span> <span class="o">*</span> <span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">eP</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)))</span>

    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      
    
<span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">):</span>

    <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
    <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">eP</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)))</span>

    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      

<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span>      <span class="c1"># time in seconds</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pH is </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1">##########################</span>
<span class="c1">### use lmfit to fit data to function </span>
<span class="c1">##########################</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s1">&#39;omit&#39;</span><span class="p">)</span>                  <span class="c1"># load the function f as the model to be fit</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;parameter names: </span><span class="si">{</span><span class="n">mod</span><span class="o">.</span><span class="n">param_names</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;independent variables: </span><span class="si">{</span><span class="n">mod</span><span class="o">.</span><span class="n">independent_vars</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                                    <span class="c1"># state the parameters (use the text strings that we used above in sympy)</span>
<span class="n">pars</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">k1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">))</span>    <span class="c1"># initial values are also set here</span>
                                    
<span class="n">result</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>            <span class="c1"># use the .fit method on the model object to perform the curve fit</span>
                                            <span class="c1"># the variable in this function is &#39;t&#39; so we must use that in the call</span>
<span class="c1">##########################</span>
<span class="c1">### get the results </span>
<span class="c1">##########################</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fit_report</span><span class="p">())</span>

<span class="n">k1_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;For pH </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">, log(k_obs) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k1_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">bestfit_y1</span> <span class="o">=</span> <span class="n">fit_u</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">k1_fit</span><span class="p">)</span>

<span class="c1">#######################################################################################</span>

<span class="c1">###############################################################################</span>
<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          teitle = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance$ &quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /s$&quot;</span><span class="p">,</span>                
<span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
        <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.175</span><span class="p">,</span> <span class="mf">0.245</span><span class="p">]</span>
       <span class="p">)</span>

<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 

<span class="c1"># Plot the curve fit line</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">),</span> 
           <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>


<span class="c1">######################</span>
<span class="c1">#### Create Confidence band upper and lower bounds</span>
<span class="c1">######################</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># upper and lower bounds of uncertain kobs as float values</span>
<span class="n">fit_up</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">+</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span>
<span class="n">fit_dn</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">-</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">fit_up</span><span class="p">,</span> <span class="n">fit_dn</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>


<span class="c1">######################</span>
<span class="c1">### Plot the residuals</span>
<span class="c1">######################</span>

<span class="c1"># difference between data and line-fit</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k1_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>      

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          title = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Residuals&quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="p">,</span>                
<span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">.018</span><span class="p">,</span><span class="mf">0.018</span><span class="p">]</span>
       <span class="p">)</span>
<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="c1">### Other elements</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>


<span class="c1">### Output plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/05A_Kirby2_1stOrder.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pH is 0.00
parameter names: [&#39;k1&#39;]
independent variables: [&#39;t&#39;]
[[Model]]
    Model(fit)
[[Fit Statistics]]
    # fitting method   = leastsq
    # function evals   = 63
    # data points      = 55
    # variables        = 1
    chi-square         = 2.5916e-04
    reduced chi-square = 4.7992e-06
    Akaike info crit   = -672.597915
    Bayesian info crit = -670.590582
    R-squared          = 0.94163347
[[Variables]]
    k1:  3.0830e-04 +/- 1.7791e-05 (5.77%) (init = 0.02)
For pH 0.00, log(k_obs) = -3.511+/-0.025
</pre></div>
</div>
<img alt="../_images/fd3094e2ff4b05cac3b8b9ad10c8b577915f98c4752ecaa0daa649590d8a2286.png" src="../_images/fd3094e2ff4b05cac3b8b9ad10c8b577915f98c4752ecaa0daa649590d8a2286.png" />
</div>
</div>
</section>
<section id="curve-fitting-the-model">
<h2>Curve Fitting the Model<a class="headerlink" href="#curve-fitting-the-model" title="Permalink to this heading">#</a></h2>
<p>let us use the equation derived for the reaction scheme as presented in the paper. Note: This is the correct equation, not the erroneous one presented in the paper. We will also fit the equation presented by the authors later in this document just to watch it blow up.</p>
<p>The code below is almost identical to that above. I changed the functions that represent the model and changed a few other places that used those functions (we have more parameters now). Otherwise its the same: make model, fit model, plot.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Calculating line fit and confidence interval using lmfit methods </span>

<span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>


<span class="c1">### This function is used in the curve fit. the curve fit tools cannot handle ufloat values    </span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>

    <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
    <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
    
    <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
    <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">At</span><span class="o">*</span><span class="n">eA</span> <span class="o">+</span> <span class="n">eI</span><span class="o">*</span><span class="n">It</span> <span class="o">+</span> <span class="n">eP</span><span class="o">*</span><span class="n">Pt</span>     

    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      

<span class="n">pH</span> <span class="o">=</span> <span class="n">pH_values</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span>      <span class="c1"># time in seconds</span>

<span class="c1">##########################</span>
<span class="c1">### use lmfit to fit data to function </span>
<span class="c1">##########################</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s1">&#39;omit&#39;</span><span class="p">)</span>  <span class="c1"># load the function f as the model to be fit</span>

                                    <span class="c1"># state the parameters (use the text strings that we used above in sympy)</span>
<span class="n">pars</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">k1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.00001</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">k2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">))</span>    <span class="c1"># initial values are also set here</span>
                                    
<span class="n">result</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Use the .fit method on the model object to perform the curve fit</span>
                                <span class="c1"># the variable in this function is &#39;t&#39; so we must use that in the call</span>
<span class="c1">##########################</span>
<span class="c1">### get the results </span>
<span class="c1">##########################</span>

<span class="c1">#   print(result.fit_report())</span>

<span class="n">k1_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span>
<span class="n">k2_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k2&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pH = </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">, log(k1) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k1_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">, log(k2) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k2_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pH = </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">, k1 = </span><span class="si">{</span><span class="n">k1_fit</span><span class="si">}</span><span class="s2">, k2 = </span><span class="si">{</span><span class="n">k2_fit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1">###############################################################################</span>
<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          teitle = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance$ &quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /s$&quot;</span><span class="p">,</span>                
<span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
<span class="c1">#          ylim=[0.175,0.245]</span>
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.189</span><span class="p">,</span><span class="mf">0.210</span><span class="p">]</span>
       <span class="p">)</span>

<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 

<span class="c1"># Plot the curve fit line</span>

<span class="n">bestfit_y1</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">x1</span><span class="p">)</span>
<span class="n">devs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval_uncertainty</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">bestfit_y1</span><span class="p">,</span> 
           <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>


<span class="c1">######################</span>
<span class="c1">#### Create Confidence band upper and lower bounds</span>
<span class="c1">######################</span>

<span class="c1"># upper and lower bounds of uncertain kobs as float values</span>
<span class="n">fit_up</span> <span class="o">=</span> <span class="n">bestfit_y1</span> <span class="o">+</span> <span class="n">devs</span>
<span class="n">fit_dn</span> <span class="o">=</span> <span class="n">bestfit_y1</span> <span class="o">-</span> <span class="n">devs</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">fit_up</span><span class="p">,</span> <span class="n">fit_dn</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">### Plot the residuals</span>
<span class="c1">######################</span>

<span class="c1"># difference between data and line-fit</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">residual</span>      

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          title = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Residuals&quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="p">,</span>                
<span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.0015</span><span class="p">,</span><span class="o">+</span><span class="mf">0.0015</span><span class="p">]</span>
       <span class="p">)</span>
<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">devs</span><span class="p">,</span> <span class="o">-</span><span class="n">devs</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">20000</span><span class="p">,</span><span class="mi">40000</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mf">0.190</span><span class="p">,</span><span class="mf">0.195</span><span class="p">,</span><span class="mf">0.200</span><span class="p">,</span><span class="mf">0.205</span><span class="p">])</span>

<span class="c1">### Output plot</span>
<span class="c1">#plt.tight_layout(pad=2, h_pad=None, w_pad=None, rect=None)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/05B_Kirby2_CorrectModel_lmfit.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pH = 1.50, log(k1) = -4.169+/-0.004, log(k2) = -4.7933+/-0.0013
pH = 1.50, k1 = (6.77+/-0.06)e-05, k2 = (1.609+/-0.005)e-05
</pre></div>
</div>
<img alt="../_images/efb1140df0023318d5c26f465c20dbca7325b745a2401367843dd2671288412c.png" src="../_images/efb1140df0023318d5c26f465c20dbca7325b745a2401367843dd2671288412c.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Calculating line fit and confidence interval using lmfit methods </span>

<span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>


<span class="c1">### This function is used in the curve fit. the curve fit tools cannot handle ufloat values    </span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>

    <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
    <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
    
    <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
    <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">At</span><span class="o">*</span><span class="n">eA</span> <span class="o">+</span> <span class="n">eI</span><span class="o">*</span><span class="n">It</span> <span class="o">+</span> <span class="n">eP</span><span class="o">*</span><span class="n">Pt</span>     

    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      

<span class="n">pH</span> <span class="o">=</span> <span class="n">pH_values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span>      <span class="c1"># time in seconds</span>

<span class="c1">##########################</span>
<span class="c1">### use lmfit to fit data to function </span>
<span class="c1">##########################</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s1">&#39;omit&#39;</span><span class="p">)</span>  <span class="c1"># load the function f as the model to be fit</span>

                                    <span class="c1"># state the parameters (use the text strings that we used above in sympy)</span>
<span class="n">pars</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">k1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.00001</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">k2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">))</span>    <span class="c1"># initial values are also set here</span>
                                    
<span class="n">result</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Use the .fit method on the model object to perform the curve fit</span>
                                <span class="c1"># the variable in this function is &#39;t&#39; so we must use that in the call</span>
<span class="c1">##########################</span>
<span class="c1">### get the results </span>
<span class="c1">##########################</span>

<span class="c1">#   print(result.fit_report())</span>

<span class="n">k1_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span>
<span class="n">k2_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k2&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pH = </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">, log(k1) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k1_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">, log(k2) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k2_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1">###############################################################################</span>
<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          title = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance$ &quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /s$&quot;</span><span class="p">,</span>                
<span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.25</span><span class="p">]</span>
       <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20000</span><span class="p">,</span><span class="mi">40000</span><span class="p">]</span>

<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 

<span class="c1"># Plot the curve fit line</span>

<span class="n">bestfit_y1</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">x1</span><span class="p">)</span>
<span class="n">devs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval_uncertainty</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">bestfit_y1</span><span class="p">,</span> 
           <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>


<span class="c1">######################</span>
<span class="c1">#### Create Confidence band upper and lower bounds</span>
<span class="c1">######################</span>

<span class="c1"># upper and lower bounds of uncertain kobs as float values</span>
<span class="n">fit_up</span> <span class="o">=</span> <span class="n">bestfit_y1</span> <span class="o">+</span> <span class="n">devs</span>
<span class="n">fit_dn</span> <span class="o">=</span> <span class="n">bestfit_y1</span> <span class="o">-</span> <span class="n">devs</span>



<span class="c1">######################</span>
<span class="c1">### Other elements - add components</span>
<span class="c1">######################</span>

<span class="k">def</span> <span class="nf">components</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>

    <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
    <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
    
    <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
    <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">Abs_A</span> <span class="o">=</span> <span class="n">At</span> <span class="o">*</span> <span class="n">eA</span> 
    <span class="n">Abs_I</span> <span class="o">=</span> <span class="n">eI</span> <span class="o">*</span> <span class="n">It</span>    
    <span class="n">Abs_P</span> <span class="o">=</span> <span class="n">eP</span> <span class="o">*</span> <span class="n">Pt</span>  

    <span class="k">return</span><span class="p">(</span><span class="n">Abs_A</span><span class="p">,</span> <span class="n">Abs_I</span><span class="p">,</span> <span class="n">Abs_P</span><span class="p">)</span>   

<span class="c1"># calculate Abs contributions for A,I and P using the curve fit parameters</span>
<span class="p">[</span><span class="n">Abs_A</span><span class="p">,</span> <span class="n">Abs_I</span><span class="p">,</span> <span class="n">Abs_P</span><span class="p">]</span> <span class="o">=</span> <span class="n">components</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">k1_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

<span class="c1"># Plot the calculated contributions from each component</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">Abs_A</span><span class="p">,</span> 
           <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> 
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">Abs_I</span><span class="p">,</span> 
           <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> 
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">Abs_P</span><span class="p">,</span> 
           <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> 
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1">### Output plot</span>
<span class="c1">#plt.tight_layout(pad=2, h_pad=None, w_pad=None, rect=None)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/05B_Kirby2_CorrectModel_lmfit_components.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pH = 0.55, log(k1) = -3.628+/-0.008, log(k2) = -3.8880+/-0.0034
</pre></div>
</div>
<img alt="../_images/62a94f419ed3cfb08a66b92372da1187a9e3919bbff36e28fe62122604bc2af0.png" src="../_images/62a94f419ed3cfb08a66b92372da1187a9e3919bbff36e28fe62122604bc2af0.png" />
</div>
</div>
</section>
<section id="the-same-thing-again-again">
<h2>The Same Thing Again &amp; Again<a class="headerlink" href="#the-same-thing-again-again" title="Permalink to this heading">#</a></h2>
<p>The code above performed a curve fit according the the model givem reported the best fit parameters found and then plotted the data and the calculated lined based on the best-fit parameters. But, it only does a single selected set of data at a time.</p>
<p>The code below is identical (almost). I have put it in a loop so that we can iterate through all the columns in the data. The best-fit parameters for <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span> will be collected in lists and then written out as a csv file for further analysis.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">lmfit</span>     
<span class="kn">import</span> <span class="nn">uncertainties</span> <span class="k">as</span> <span class="nn">un</span>               <span class="c1"># tool set for handling uncertainties</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="kn">import</span> <span class="n">unumpy</span> <span class="k">as</span> <span class="n">unp</span>  <span class="c1"># a replacement for numpy </span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1">### This function is used in the curve fit. the curve fit tools cannot handle ufloat values    </span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>

    <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
    <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
    
    <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
    <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">At</span><span class="o">*</span><span class="n">eA</span> <span class="o">+</span> <span class="n">eI</span><span class="o">*</span><span class="n">It</span> <span class="o">+</span> <span class="n">eP</span><span class="o">*</span><span class="n">Pt</span>     

    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      

<span class="c1">### This function is the same as used in the curve fit. It uses ufloat values and it is used</span>
<span class="c1">### when we calculate the line fit and include uncertainties for the confidence interval.    </span>
<span class="k">def</span> <span class="nf">f_u</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>

    <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
    <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
    
    <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
    <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">At</span><span class="o">*</span><span class="n">eA</span> <span class="o">+</span> <span class="n">eI</span> <span class="o">*</span> <span class="n">It</span> <span class="o">+</span> <span class="n">eP</span> <span class="o">*</span> <span class="n">Pt</span>     

    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      

<span class="n">pH_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">k1_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">k1_list_stdev</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">k2_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">k2_list_stdev</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span>      <span class="c1"># time in seconds</span>
    
<span class="k">for</span> <span class="n">pH</span> <span class="ow">in</span> <span class="n">pH_values</span><span class="p">:</span>     <span class="c1"># choose one of the pH columns</span>
    
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>
    <span class="n">pH_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pH</span><span class="p">)</span>

    <span class="c1">##########################</span>
    <span class="c1">### use lmfit to fit data to function </span>
    <span class="c1">##########################</span>
    
    <span class="n">mod</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s1">&#39;omit&#39;</span><span class="p">)</span>  <span class="c1"># load the function f as the model to be fit</span>
    
                                        <span class="c1"># state the parameters (use the text strings that we used above in sympy)</span>
    <span class="n">pars</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">k1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                           <span class="n">k2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.00001</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">))</span>    <span class="c1"># initial values are also set here</span>
                                        
    <span class="n">result</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Use the .fit method on the model object to perform the curve fit</span>
                                    <span class="c1"># the variable in this function is &#39;t&#39; so we must use that in the call</span>
    <span class="c1">##########################</span>
    <span class="c1">### get the results </span>
    <span class="c1">##########################</span>
    
<span class="c1">#    print(result.fit_report())</span>
    
    <span class="n">k1_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span>
    <span class="n">k2_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k2&#39;</span><span class="p">]</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pH = </span><span class="si">{</span><span class="n">pH_value</span><span class="si">}</span><span class="s2">, log(k1) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k1_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">, log(k2) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k2_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">bestfit_y1</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">x1</span><span class="p">)</span>   <span class="c1"># uncertain values - used for confidence interval</span>
    <span class="n">devs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval_uncertainty</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
    
    
    <span class="c1">#######################################################################################</span>
    
    <span class="c1">###############################################################################</span>
    <span class="c1">######################</span>
    <span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
    <span class="c1">######################</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  
    
    <span class="c1"># Settings for plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="c1">#          teitle = Title,       </span>
              <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance$ &quot;</span><span class="p">,</span> 
              <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /s$&quot;</span><span class="p">,</span>                
    <span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
              <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.25</span><span class="p">]</span>
           <span class="p">)</span>
    
    <span class="c1">### Data graphics</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                  <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
                  <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 
    
    <span class="c1"># Plot the curve fit line</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">),</span> 
               <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
               <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    
    <span class="c1">######################</span>
    <span class="c1">#### Create Confidence band upper and lower bounds</span>
    <span class="c1">######################</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>
    
    <span class="c1"># upper and lower bounds of uncertain kobs as float values</span>
    <span class="n">fit_up</span> <span class="o">=</span> <span class="n">bestfit_y1</span> <span class="o">+</span> <span class="n">devs</span>
    <span class="n">fit_dn</span> <span class="o">=</span> <span class="n">bestfit_y1</span> <span class="o">-</span> <span class="n">devs</span>
    
    <span class="c1"># make filled band</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">fit_up</span><span class="p">,</span> <span class="n">fit_dn</span><span class="p">,</span> 
                       <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>
    
    <span class="c1">######################</span>
    <span class="c1">#### Add to the Lists</span>
    <span class="c1">######################</span>

    <span class="n">pH_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pH_value</span><span class="p">)</span> 
    <span class="n">k1_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k1_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
    <span class="n">k1_list_stdev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k1_fit</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
    <span class="n">k2_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
    <span class="n">k2_list_stdev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k2_fit</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>

    <span class="c1">######################</span>
    <span class="c1">### Plot the residuals</span>
    <span class="c1">######################</span>
    
    <span class="c1"># difference between data and line-fit</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">residual</span>      
    
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="c1">#          title = Title,       </span>
              <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Residuals&quot;</span><span class="p">,</span> 
              <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="p">,</span>                
    <span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.002</span><span class="p">,</span><span class="o">+</span><span class="mf">0.002</span><span class="p">]</span>
           <span class="p">)</span>
    <span class="c1">### Data graphics</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                  <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
                  <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
    
    <span class="c1"># make filled band</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">devs</span><span class="p">,</span> <span class="o">-</span><span class="n">devs</span><span class="p">,</span> 
                       <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                       <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    
    <span class="c1">######################</span>
    <span class="c1">### Other elements - add components</span>
    <span class="c1">######################</span>
    
    <span class="k">def</span> <span class="nf">components</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
    
        <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
        <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
        <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
        <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
        
        <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
        <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
        <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
        <span class="n">Abs_A</span> <span class="o">=</span> <span class="n">At</span> <span class="o">*</span> <span class="n">eA</span> 
        <span class="n">Abs_I</span> <span class="o">=</span> <span class="n">eI</span> <span class="o">*</span> <span class="n">It</span>    
        <span class="n">Abs_P</span> <span class="o">=</span> <span class="n">eP</span> <span class="o">*</span> <span class="n">Pt</span>  
    
        <span class="k">return</span><span class="p">(</span><span class="n">Abs_A</span><span class="p">,</span> <span class="n">Abs_I</span><span class="p">,</span> <span class="n">Abs_P</span><span class="p">)</span>   
    
    <span class="c1"># calculate Abs contributions for A,I and P using the curve fit parameters</span>
    <span class="p">[</span><span class="n">Abs_A</span><span class="p">,</span> <span class="n">Abs_I</span><span class="p">,</span> <span class="n">Abs_P</span><span class="p">]</span> <span class="o">=</span> <span class="n">components</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">k1_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
    
    <span class="c1"># Plot the calculated contributions from each component</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">Abs_A</span><span class="p">,</span> 
               <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> 
               <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">Abs_I</span><span class="p">,</span> 
               <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> 
               <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">Abs_P</span><span class="p">,</span> 
               <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> 
               <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.26</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;pH = </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1">### Output plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/fits/05B_Kirby2_CorrectModel_pH_&quot;</span><span class="o">+</span><span class="n">pH</span><span class="o">+</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">df_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;pH&quot;</span><span class="p">:</span> <span class="n">pH_list</span><span class="p">,</span>
                       <span class="s2">&quot;k1 value&quot;</span><span class="p">:</span> <span class="n">k1_list</span><span class="p">,</span>
                       <span class="s2">&quot;k1 stdev&quot;</span><span class="p">:</span> <span class="n">k1_list_stdev</span><span class="p">,</span>
                       <span class="s2">&quot;k2 value&quot;</span><span class="p">:</span> <span class="n">k2_list</span><span class="p">,</span>
                       <span class="s2">&quot;k2 stdev&quot;</span><span class="p">:</span> <span class="n">k2_list_stdev</span>
                       <span class="p">})</span>

<span class="n">df_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/results.csv&quot;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pH = 0.0, log(k1) = -2.961+/-0.023, log(k2) = -3.182+/-0.011
pH = 0.28, log(k1) = -3.309+/-0.011, log(k2) = -3.535+/-0.005
pH = 0.55, log(k1) = -3.628+/-0.008, log(k2) = -3.8880+/-0.0034
pH = 1.0, log(k1) = -3.873+/-0.007, log(k2) = -4.2124+/-0.0028
pH = 1.25, log(k1) = -4.164+/-0.004, log(k2) = -4.4735+/-0.0018
pH = 1.5, log(k1) = -4.169+/-0.004, log(k2) = -4.7933+/-0.0013
pH = 1.9, log(k1) = -4.1719+/-0.0035, log(k2) = -5.0936+/-0.0019
pH = 2.25, log(k1) = -4.0821+/-0.0028, log(k2) = -5.2757+/-0.0020
pH = 2.6, log(k1) = -3.8898+/-0.0032, log(k2) = -5.3293+/-0.0021
pH = 3.4, log(k1) = -3.484+/-0.005, log(k2) = -5.4133+/-0.0024
pH = 3.7, log(k1) = -3.253+/-0.006, log(k2) = -5.4431+/-0.0023
pH = 4.1, log(k1) = -3.110+/-0.008, log(k2) = -5.4590+/-0.0025
pH = 4.4, log(k1) = -3.077+/-0.007, log(k2) = -5.3941+/-0.0019
pH = 4.75, log(k1) = -3.176+/-0.007, log(k2) = -5.2207+/-0.0016
pH = 5.1, log(k1) = -3.409+/-0.006, log(k2) = -5.2243+/-0.0017
pH = 5.6, log(k1) = -3.759+/-0.005, log(k2) = -4.9455+/-0.0013
pH = 6.0, log(k1) = -4.070+/-0.005, log(k2) = -4.5495+/-0.0016
pH = 6.5, log(k1) = -4.608+/-0.005, log(k2) = -4.138+/-0.005
pH = 6.9, log(k1) = -5.014+/-0.005, log(k2) = -3.775+/-0.013
</pre></div>
</div>
</div>
</div>
<section id="the-ph-rate-profile">
<h3>The pH-rate profile<a class="headerlink" href="#the-ph-rate-profile" title="Permalink to this heading">#</a></h3>
<p>We now have best-fit parameters for <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span>. We can now plot these values against pH to visualize a pH-rate profile for each reaction.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s2">&quot;results.csv&quot;</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>

<span class="c1">#display(df3.head())</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[</span><span class="s2">&quot;pH&quot;</span><span class="p">]</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">df3</span><span class="p">[</span><span class="s2">&quot;k1 value&quot;</span><span class="p">],</span><span class="n">df3</span><span class="p">[</span><span class="s2">&quot;k1 stdev&quot;</span><span class="p">])</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">df3</span><span class="p">[</span><span class="s2">&quot;k2 value&quot;</span><span class="p">],</span><span class="n">df3</span><span class="p">[</span><span class="s2">&quot;k2 stdev&quot;</span><span class="p">])</span>

<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>

<span class="n">y1n</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">y2n</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
<span class="n">y1s</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">y2s</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\log{(k_</span><span class="si">{obs}</span><span class="s2">\ /s^{-1})}$ &quot;</span><span class="p">,</span> 
       <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$pH$&quot;</span><span class="p">,</span>                
       <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">7.1</span><span class="p">],</span>                  
<span class="c1">#       ylim=[-0.03,0.65]</span>
       <span class="p">)</span>

<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1n</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y2n</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1n</span><span class="p">,</span> <span class="n">y1s</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">elinewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y2n</span><span class="p">,</span> <span class="n">y2s</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">elinewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1">### Output plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/05B_Kirby2_k1_k2.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/329fd95063093b8060372f19d57747caf816b3f82c9be8009ecf03e6a7c7ee6a.png" src="../_images/329fd95063093b8060372f19d57747caf816b3f82c9be8009ecf03e6a7c7ee6a.png" />
</div>
</div>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">#</a></h2>
<p>We now have determined best fit parameters for all the kinetic experiments and plotted them in the pH-rate profile above. Along the way we learned to check the line fits visually by using residual plots. We observed that line fits can be influenced by initial conditions.</p>
<p>After making an adjustment in the initial conditions for the highest pH run we now have best-fit parameters for all pH points. In the next notebook we will fit the pH-rate profile to a model for acid-base catalysis.</p>
</section>
<section id="extra-the-wrong-equation">
<h2>Extra: The Wrong Equation<a class="headerlink" href="#extra-the-wrong-equation" title="Permalink to this heading">#</a></h2>
<p>The equation 3 in the paper has two typographical errors. If we were to use it for a curve fit we get nonsense results. Consider the code below that uses the incorrect equation as is.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">lmfit</span>     
<span class="kn">import</span> <span class="nn">uncertainties</span> <span class="k">as</span> <span class="nn">un</span>               <span class="c1"># tool set for handling uncertainties</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="kn">import</span> <span class="n">unumpy</span> <span class="k">as</span> <span class="n">unp</span>  <span class="c1"># a replacement for numpy </span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="n">pH</span> <span class="o">=</span> <span class="n">pH_values</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span>     <span class="c1"># choose one of the pH columns</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pH is </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fit_u</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>  <span class="c1"># wrong equation</span>

    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span> <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">;</span> <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    
    <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
    <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">At</span><span class="o">*</span><span class="n">eA</span> <span class="o">+</span> <span class="n">eI</span> <span class="o">*</span> <span class="n">It</span> <span class="o">+</span> <span class="n">eP</span> <span class="o">*</span> <span class="n">Pt</span>     

    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      
    
<span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>

    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span> <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">;</span> <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    
    <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
    <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">At</span><span class="o">*</span><span class="n">eA</span> <span class="o">+</span> <span class="n">eI</span><span class="o">*</span><span class="n">It</span> <span class="o">+</span> <span class="n">eP</span><span class="o">*</span><span class="n">Pt</span>     

    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      

<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span>      <span class="c1"># time in seconds</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>

<span class="c1">##########################</span>
<span class="c1">### use lmfit to fit data to function </span>
<span class="c1">##########################</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s1">&#39;omit&#39;</span><span class="p">)</span>                  <span class="c1"># load the function f as the model to be fit</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;parameter names: </span><span class="si">{</span><span class="n">mod</span><span class="o">.</span><span class="n">param_names</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;independent variables: </span><span class="si">{</span><span class="n">mod</span><span class="o">.</span><span class="n">independent_vars</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                                    <span class="c1"># state the parameters (use the text strings that we used above in sympy)</span>
<span class="n">pars</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">k1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.00002</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">k2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.000002</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">))</span>    <span class="c1"># initial values are also set here</span>
                                    
<span class="n">result</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>          <span class="c1"># use the .fit method on the model object to perform the curve fit</span>
                                        <span class="c1"># the variable in this function is &#39;t&#39; so we must use that in the call</span>
<span class="c1">##########################</span>
<span class="c1">### get the results </span>
<span class="c1">##########################</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fit_report</span><span class="p">())</span>

<span class="n">k1_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span>
<span class="n">k2_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k2&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log(k1) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k1_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log(k2) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k2_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">bestfit_y1</span> <span class="o">=</span> <span class="n">fit_u</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">k1_fit</span><span class="p">,</span> <span class="n">k2_fit</span><span class="p">)</span>

<span class="c1">###############################################################################</span>
<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          teitle = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance$ &quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /s$&quot;</span><span class="p">,</span>                
<span class="c1">#          xlim=[-100, 10000],                  </span>
        <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.175</span><span class="p">,</span> <span class="mf">0.325</span><span class="p">]</span>
       <span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 

<span class="c1"># Plot the curve fit line</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">),</span> 
           <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>


<span class="c1">######################</span>
<span class="c1">#### Create Confidence band upper and lower bounds</span>
<span class="c1">######################</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># upper and lower bounds of uncertain kobs as float values</span>
<span class="n">fit_up</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">+</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span>
<span class="n">fit_dn</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">-</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">fit_up</span><span class="p">,</span> <span class="n">fit_dn</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">### Plot the residuals</span>
<span class="c1">######################</span>

<span class="c1"># difference between data and line-fit</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k1_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>      

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          title = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Residuals&quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="p">,</span>                
<span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.002</span><span class="p">,</span><span class="o">+</span><span class="mf">0.002</span><span class="p">]</span>
       <span class="p">)</span>
<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="c1">### Other elements</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>


<span class="c1">### Output plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/05C_Kirby2_wrongEq.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pH is 5.60
parameter names: [&#39;k1&#39;, &#39;k2&#39;]
independent variables: [&#39;t&#39;]
[[Model]]
    Model(fit)
[[Fit Statistics]]
    # fitting method   = leastsq
    # function evals   = 361
    # data points      = 55
    # variables        = 2
    chi-square         = 0.01478422
    reduced chi-square = 2.7895e-04
    Akaike info crit   = -448.184044
    Bayesian info crit = -444.169378
    R-squared          = -9.40531516
[[Variables]]
    k1:  6.2843e-06 +/- 3.5067e-06 (55.80%) (init = 2e-05)
    k2:  0.89508456 +/- 0.03324878 (3.71%) (init = 2e-06)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(k1, k2) = -0.8486
log(k1) = -5.20+/-0.24
log(k2) = -0.048+/-0.016
</pre></div>
</div>
<img alt="../_images/81f1d916a812f55cc72801e920888fba0b23f985e79b0f7364d424a793c2a4a7.png" src="../_images/81f1d916a812f55cc72801e920888fba0b23f985e79b0f7364d424a793c2a4a7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.32       0.18766501 0.18595955 ... 0.20016085 0.20016207 0.20016329]
</pre></div>
</div>
</div>
</div>
</section>
<section id="multiplot">
<h2>Multiplot<a class="headerlink" href="#multiplot" title="Permalink to this heading">#</a></h2>
<p>here is a 2X2 array of plots to create a figure for the document</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">lmfit</span>
<span class="kn">import</span> <span class="nn">uncertainties</span> <span class="k">as</span> <span class="nn">un</span>               <span class="c1"># tool set for handling uncertainties</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="kn">import</span> <span class="n">unumpy</span> <span class="k">as</span> <span class="n">unp</span>  <span class="c1"># a replacement for numpy </span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>


<span class="k">def</span> <span class="nf">components</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>

    <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
    <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
    
    <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
    <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">Abs_A</span> <span class="o">=</span> <span class="n">At</span> <span class="o">*</span> <span class="n">eA</span> 
    <span class="n">Abs_I</span> <span class="o">=</span> <span class="n">eI</span> <span class="o">*</span> <span class="n">It</span>    
    <span class="n">Abs_P</span> <span class="o">=</span> <span class="n">eP</span> <span class="o">*</span> <span class="n">Pt</span>  

    <span class="k">return</span><span class="p">(</span><span class="n">Abs_A</span><span class="p">,</span> <span class="n">Abs_I</span><span class="p">,</span> <span class="n">Abs_P</span><span class="p">)</span>   

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>

    <span class="p">[</span><span class="n">Abs_A</span><span class="p">,</span> <span class="n">Abs_I</span><span class="p">,</span> <span class="n">Abs_P</span><span class="p">]</span> <span class="o">=</span> <span class="n">components</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">Abs_A</span> <span class="o">+</span> <span class="n">Abs_I</span> <span class="o">+</span> <span class="n">Abs_P</span>     
    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      

<span class="k">def</span> <span class="nf">fitarun</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pH</span><span class="p">):</span>
    <span class="n">mod</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s1">&#39;omit&#39;</span><span class="p">)</span>  
    <span class="n">pars</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">k1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.00001</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                           <span class="n">k2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">))</span>                   
    <span class="n">result</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>  
    
    <span class="c1">#print(f&quot;pH = {pH}&quot;)</span>
    <span class="c1">#print(result.fit_report())    </span>

    <span class="n">k1_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span>
    <span class="n">k2_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k2&#39;</span><span class="p">]</span>    

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pH = </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">, log(k1) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k1_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">, log(k2) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k2_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plotplot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
    
    <span class="n">k1_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span>
    <span class="n">k2_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k2&#39;</span><span class="p">]</span>    

    <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">500</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
              <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance$ &quot;</span><span class="p">,</span> 
              <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /s$&quot;</span><span class="p">,</span>                
    <span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
              <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.25</span><span class="p">]</span>
           <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">20000</span><span class="p">,</span><span class="mi">40000</span><span class="p">])</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                  <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
                  <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 
    <span class="n">bestfit_y1</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">x1</span><span class="p">)</span>
    <span class="n">devs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval_uncertainty</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">bestfit_y1</span><span class="p">,</span> 
               <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
               <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># upper and lower bounds of uncertain kobs as float values</span>
    <span class="n">fit_up</span> <span class="o">=</span> <span class="n">bestfit_y1</span> <span class="o">+</span> <span class="n">devs</span>
    <span class="n">fit_dn</span> <span class="o">=</span> <span class="n">bestfit_y1</span> <span class="o">-</span> <span class="n">devs</span>
    
    <span class="p">[</span><span class="n">Abs_A</span><span class="p">,</span> <span class="n">Abs_I</span><span class="p">,</span> <span class="n">Abs_P</span><span class="p">]</span> <span class="o">=</span> <span class="n">components</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">k1_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

    <span class="c1"># Plot the calculated contributions from each component</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">Abs_A</span><span class="p">,</span> 
               <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> 
               <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">Abs_I</span><span class="p">,</span> 
               <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> 
               <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">Abs_P</span><span class="p">,</span> 
               <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> 
               <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span><span class="mf">0.105</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;pH = </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span><span class="mf">0.085</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;k1 = </span><span class="si">{</span><span class="n">k1_fit</span><span class="si">:</span><span class="s2">0.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span><span class="mf">0.065</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;k2 = </span><span class="si">{</span><span class="n">k2_fit</span><span class="si">:</span><span class="s2">0.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s2">&quot;Kirby2002/Abs_t_pH_ALL.csv&quot;</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="n">time_column</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="c1"># get the column label for the first column (time)</span>
<span class="n">pH_values</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>     <span class="c1"># get the column labels that are the pH values</span>

<span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">pH_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">18</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>  
<span class="c1">#fig, ax = plt.subplots(nrows=1, ncols=1, figsize=[4,4])  </span>


<span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">q</span><span class="o">*</span><span class="mi">2</span>
        <span class="n">pH</span> <span class="o">=</span> <span class="n">pH_values</span><span class="p">[</span><span class="n">pH_list</span><span class="p">[</span><span class="n">s</span><span class="p">]]</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span>      <span class="c1"># time in seconds</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="n">fitarun</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pH</span><span class="p">)</span>
        <span class="n">plotplot</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="n">r</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>


<span class="c1">### Output plot</span>
<span class="c1">#plt.tight_layout(pad=2, h_pad=None, w_pad=None, rect=None)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/05B_Kirby2_CorrectModel_lmfit_4plots.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time (hr)</th>
      <th>0.00</th>
      <th>0.28</th>
      <th>0.55</th>
      <th>1.00</th>
      <th>1.25</th>
      <th>1.50</th>
      <th>1.90</th>
      <th>2.25</th>
      <th>2.60</th>
      <th>3.40</th>
      <th>3.70</th>
      <th>4.10</th>
      <th>4.40</th>
      <th>4.75</th>
      <th>5.10</th>
      <th>5.60</th>
      <th>6.00</th>
      <th>6.50</th>
      <th>6.90</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.00</td>
      <td>0.2001</td>
      <td>0.2000</td>
      <td>0.2001</td>
      <td>0.2000</td>
      <td>0.2000</td>
      <td>0.1997</td>
      <td>0.1998</td>
      <td>0.2000</td>
      <td>0.2002</td>
      <td>0.2003</td>
      <td>0.1999</td>
      <td>0.1997</td>
      <td>0.2000</td>
      <td>0.2000</td>
      <td>0.1999</td>
      <td>0.2002</td>
      <td>0.1999</td>
      <td>0.2002</td>
      <td>0.2003</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.25</td>
      <td>0.1980</td>
      <td>0.1957</td>
      <td>0.1969</td>
      <td>0.1981</td>
      <td>0.1989</td>
      <td>0.1990</td>
      <td>0.1990</td>
      <td>0.1988</td>
      <td>0.1978</td>
      <td>0.1951</td>
      <td>0.1918</td>
      <td>0.1901</td>
      <td>0.1894</td>
      <td>0.1910</td>
      <td>0.1941</td>
      <td>0.1968</td>
      <td>0.1985</td>
      <td>0.1998</td>
      <td>0.1999</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.50</td>
      <td>0.2096</td>
      <td>0.1970</td>
      <td>0.1958</td>
      <td>0.1965</td>
      <td>0.1978</td>
      <td>0.1980</td>
      <td>0.1977</td>
      <td>0.1973</td>
      <td>0.1960</td>
      <td>0.1911</td>
      <td>0.1872</td>
      <td>0.1851</td>
      <td>0.1848</td>
      <td>0.1867</td>
      <td>0.1897</td>
      <td>0.1948</td>
      <td>0.1974</td>
      <td>0.1993</td>
      <td>0.1998</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.75</td>
      <td>0.2203</td>
      <td>0.2014</td>
      <td>0.1953</td>
      <td>0.1958</td>
      <td>0.1968</td>
      <td>0.1966</td>
      <td>0.1965</td>
      <td>0.1959</td>
      <td>0.1941</td>
      <td>0.1884</td>
      <td>0.1848</td>
      <td>0.1826</td>
      <td>0.1825</td>
      <td>0.1836</td>
      <td>0.1874</td>
      <td>0.1926</td>
      <td>0.1965</td>
      <td>0.1988</td>
      <td>0.1998</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.00</td>
      <td>0.2277</td>
      <td>0.2065</td>
      <td>0.1964</td>
      <td>0.1948</td>
      <td>0.1965</td>
      <td>0.1962</td>
      <td>0.1957</td>
      <td>0.1952</td>
      <td>0.1926</td>
      <td>0.1862</td>
      <td>0.1835</td>
      <td>0.1819</td>
      <td>0.1816</td>
      <td>0.1824</td>
      <td>0.1856</td>
      <td>0.1915</td>
      <td>0.1953</td>
      <td>0.1989</td>
      <td>0.1996</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pH = 0.00, log(k1) = -2.961+/-0.023, log(k2) = -3.182+/-0.011
pH = 1.50, log(k1) = -4.169+/-0.004, log(k2) = -4.7933+/-0.0013
pH = 4.10, log(k1) = -3.110+/-0.008, log(k2) = -5.4590+/-0.0025
pH = 6.90, log(k1) = -5.014+/-0.005, log(k2) = -3.775+/-0.013
</pre></div>
</div>
<img alt="../_images/ceab25783e7aceee1ec875d5b211917efbf3289d8df2216574e55379d879eb9b.png" src="../_images/ceab25783e7aceee1ec875d5b211917efbf3289d8df2216574e55379d879eb9b.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Class_11"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="04-Kirby2_PlotEqsFromPaper.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">4: Numeric Integration</p>
      </div>
    </a>
    <a class="right-next"
       href="06-Kirby2_DataAnalysis.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">6: pH-Rate Data Analysis</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2-part-5-ph-rate-profile-example-kirby-2002">Example 2, Part 5: pH-Rate Profile Example - Kirby 2002</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-equations">The equations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-data">Plot the Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#many-plots">Many Plots</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#curve-fit-to-1st-order">Curve Fit to 1st Order</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#curve-fitting-the-model">Curve Fitting the Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-same-thing-again-again">The Same Thing Again &amp; Again</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-ph-rate-profile">The pH-rate profile</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-the-wrong-equation">Extra: The Wrong Equation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiplot">Multiplot</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Barry Linkletter
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>