

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>6: pH-Rate Data Analysis &#8212; Chem 4410 Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tufte.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Class_11/_build/jupyter_execute/06-Kirby2_DataAnalysis';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../../start.html">
  
  
  
  
  
  
    <p class="title logo__title">Chem 4410 Python</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../start.html">
                    Chem 4410 Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Thermochemistry</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../Class_05/Group_Increments_Class_Handout_Discussion-Problem1.html">Group Increments Handout Discussion - Problem 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Class_05/Group_Increments_Class_Handout_Discussion-Problem5.html">Group Increments Handout Discussion - Problems 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Class_05/Group_Increments_Class_Handout_Discussion-Problems2to4.html">Group Increments - Handout Discussion - Problems 2 to 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Class_05/Group_Increments_ClassExercises.html">Group Increments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Class_06/AValueClasshandoutDiscussion.html">07 Handout A-Value Calculations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Acid and Bases</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../Class_08/Correlations.html">Plotting Related <span class="math notranslate nohighlight">\(pK_a\)</span> Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Class_08/CurveSmoothAndInterpolate.html">Data Smoothing and Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Class_08/H0_Data.html">Acidity Function Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Class_08/HNO3_Acidity_Function_Calcs.html">Lesson #3, Meeting #8, Class Problem #1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Class_08/HNO3_Acidity_Function.html">HNO<sub>3</sub> Acidity Function Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Class_08/LookAheadToKinetics.html">A Look Ahead to Kinetics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Class_08/Question5_13.html">Chapter 5, Question 13</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Aspirin Hydrolysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../Class_10/aspirin_notebook_with_uncertainty.html">Aspirin Hydrolysis Curve Fits</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Kirby Enzyme Models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../01-Kirby2_PlotEqsFromPaper.html">1: The Literature Equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02-Kirby2_PlotEqsFromPaper.html">2: The Correct Equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../03-Kirby2_PlotEqsFromPaper.html">3: Integrating the Rate Laws</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04-Kirby2_PlotEqsFromPaper.html">4: Numeric Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../05-Kirby2_DataAnalysis.html">5: Abs vs Time Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../06-Kirby2_DataAnalysis.html">6: pH-Rate Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04X-Kirby2_PlotEqsFromPaper.html">X: Creating Data Sets</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extras</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../Class_09/CatenaryCurve.html">The Hammond Postulate and Rope</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/blinkletter/4410PythonNotebooks/blob/main/./Class_11/_build/jupyter_execute/06-Kirby2_DataAnalysis.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/blinkletter/4410PythonNotebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/Class_11/_build/jupyter_execute/06-Kirby2_DataAnalysis.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>6: pH-Rate Data Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2-part-6-ph-rate-profile-example-kirby-2002">Example 2, Part 6: pH-Rate Profile Example - Kirby 2002</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-equation">The Equation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-equations-as-used-by-the-authors">The Equations as Used by the Authors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-note-on-k-h">A Note on <span class="math notranslate nohighlight">\(k_H\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-note-on-k-a-ah-3">A Note on <span class="math notranslate nohighlight">\(K_{a_{AH_3^+}}\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-the-data">Load the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-function">Define the Function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#curve-fit">Curve Fit</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#line-fit-with-weights">Line Fit with Weights</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#line-fit-with-no-weights">Line Fit with No Weights</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ph-rate-profiles-for-k-2">pH-rate Profiles for <span class="math notranslate nohighlight">\(k_2\)</span></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="ph-rate-data-analysis">
<h1>6: pH-Rate Data Analysis<a class="headerlink" href="#ph-rate-data-analysis" title="Permalink to this heading">#</a></h1>
<section id="example-2-part-6-ph-rate-profile-example-kirby-2002">
<h2>Example 2, Part 6: pH-Rate Profile Example - Kirby 2002<a class="headerlink" href="#example-2-part-6-ph-rate-profile-example-kirby-2002" title="Permalink to this heading">#</a></h2>
<p>Tony Kirby is one of the giants of physical organic and bio-organic chemistry. In this paper he follows up on a decades-long series of papers investigating the mechanism of <em>amylases</em> that catalyze the hydrolysis of acetal groups in polysaccharide chains.</p>
<p>``Concerted general acid and nucleophilic catalysis of acetalhydrolysis. A simple model for the lysozyme mechanism’’. K.E.S. Deana, A.J. Kirby, <em>J. Chem. Soc., Perkin Trans. 2</em>, <strong>2002</strong>, 428-432. https://doi.org/10.1039/B110948K.</p>
<p>This <em>Python</em> notebook will curve fit the equation the model for the values of <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span>. Both are observed rate consatnts for different reactions that demonstrate acid and base catalysis. <span class="math notranslate nohighlight">\(k_1\)</span> is the observed rate constant for acetal hydrolysis in the starting material and <span class="math notranslate nohighlight">\(k_2\)</span> is the observed rate consant for ester hydrolysis of the intermediate. Both rate constants have a dependance on pH, indicating acid/base catalysis.</p>
</section>
<section id="the-equation">
<h2>The Equation<a class="headerlink" href="#the-equation" title="Permalink to this heading">#</a></h2>
<p>For our reaction system…</p>
<div class="math notranslate nohighlight">
\[\text{A} \overset{k_1}{\longrightarrow} \text{I} + \text{P}\]</div>
<div class="math notranslate nohighlight">
\[\text{I} \overset{k_2}{\longrightarrow} \text{P}\]</div>
<p>We have determined the values of <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span> along a series of different values for <span class="math notranslate nohighlight">\(\left[H^+\right]\)</span></p>
<p>For <span class="math notranslate nohighlight">\(k_1\)</span>, the model for acid/base catalysis is <span class="math notranslate nohighlight">\(\frac{-d[A]}{dt} = k_1 [A]\)</span>. We will see that this observed rate is the total of the rate of neutral caroxylic acid attack at the protonated acetal group (<span class="math notranslate nohighlight">\(k_{AH_3^+}[AH_3^+]\)</span>), the rate of neutral caroxylic acid attack on the neutral acetal group with general-acid assistance from the other neutral carboxylic acid (<span class="math notranslate nohighlight">\(k_{AH_3^+}[AH_3^+]\)</span>), and the rate of attack of the anionic carboxylate attack on the neutral acetal group with general-acid assistance from the other neutral caroxylic acid(<span class="math notranslate nohighlight">\(k_{AH_3^+}[AH_3^+]\)</span>). The rate of nucleophilic attack on an acetal without acid catalysis is negligible so there is no rate contibution for the dianion or for direct hydroxide attack. Thus the total value for the rate could be taken to be…</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
\frac{-d[A]}{dt} =\nu &amp;= \nu_{AH_3^+} + \nu_{AH_2} + \nu_{AH^-} \\
                  \nu &amp;= k_{AH_3}[AH_3^+] + k_{AH_2}[AH_2] + k_{AH}[AH^-]
\end{align*}
\end{split}\]</div>
<p>There are three acid equilibria here…</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
K_{a_{AH_3}} &amp;= \frac{[AH_2][H^+]}{[AH_3^+]} \\
K_{a_{AH_2}} &amp;= \frac{[AH^-][H^+]}{[AH_2]} \\
K_{a_{AH}} &amp;= \frac{[A^{2-}][H^+]}{[AH^-]} 
\end{align*}
\end{split}\]</div>
<p>…and…</p>
<div class="math notranslate nohighlight">
\[[A] = [AH_3^+] + [AH_2] + [AH^-] + [A^{2-}]\]</div>
<section id="the-equations-as-used-by-the-authors">
<h3>The Equations as Used by the Authors<a class="headerlink" href="#the-equations-as-used-by-the-authors" title="Permalink to this heading">#</a></h3>
<p>The authors of the paper considered the value of <span class="math notranslate nohighlight">\([AH_3^+]\)</span> to be insignificant relative to <span class="math notranslate nohighlight">\([A]_t\)</span> in the pH range studies. This is a reasonable statement as the protonated acetal, which will contribute greatly to the observed rate of reaction, is still only a tiny fraction of the population unless we reach extreme acidity. We will not be able to determine the value of <span class="math notranslate nohighlight">\(K_{a_{AH_3^+}}\)</span> from the curve fit and it is best to ignore it. In practice this means that <span class="math notranslate nohighlight">\(k_{AH_3^+}\)</span> will be a second-order rate consant for the reaction of <span class="math notranslate nohighlight">\(AH_2\)</span> and <span class="math notranslate nohighlight">\(H^+\)</span> to give the product and that the value of <span class="math notranslate nohighlight">\(k_{AH_3^+}\)</span> will include wthe value of <span class="math notranslate nohighlight">\(K_{a_{AH_3^+}}\)</span> within it.</p>
<p>So the equation 4 in the paper is derived from the following rate law and value for <span class="math notranslate nohighlight">\([A]_t\)</span>…</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
\nu &amp;= k_{H}[H^+][AH_2] + k_{AH_2}[AH_2] + k_{AH}[AH^-] \\
[A] &amp;= [AH_2] + [AH^-] + [A^{2-}]
\end{align*}
\end{split}\]</div>
<p>…where <span class="math notranslate nohighlight">\(k_{H^+}\)</span> is the second-order rate constant for the specific acid catalyzed reaction of the neutral diacid.</p>
<p>With the two statements above we can derive the equation that describes the value of <span class="math notranslate nohighlight">\(k_1\)</span> as <span class="math notranslate nohighlight">\([H^+]\)</span> changes.</p>
<div class="math notranslate nohighlight">
\[ \nu_T = 
\frac{k_{H}[H^+]^3 + {k_{AH_2} [H^+]^2} + k_{AH}K_{a_{AH_2}}[H^+]}
{{ [H^+]^2} + { K_{a_{AH_2}} [H^+]} + { K_{a_{AH_2}} K_{a_{AH}}} } [A]\]</div>
<p>And so the observed rate constant at a given pH is described by the following equation…</p>
<div class="math notranslate nohighlight">
\[ k_1 = 
\frac{k_{H^+}[H^+]^3 + {k_{AH_2} [H^+]^2} + k_{AH}K_{a_{AH_2}}[H^+]}
{{ [H^+]^2} + { K_{a_{AH_2}} [H^+]} + { K_{a_{AH_2}} K_{a_{AH}}} } \]</div>
<p>…where…
$<span class="math notranslate nohighlight">\( \nu = k_1 [A]\)</span>$</p>
</section>
<section id="a-note-on-k-h">
<h3>A Note on <span class="math notranslate nohighlight">\(k_H\)</span><a class="headerlink" href="#a-note-on-k-h" title="Permalink to this heading">#</a></h3>
<p>If we consider the rate contribution for the <span class="math notranslate nohighlight">\(AH_3^+\)</span> species we would have…</p>
<div class="math notranslate nohighlight">
\[\nu_{AH_3^+}=k_{AH_3}[AH_3^+] = k_{AH_3}\frac{[H^+][AH_2]}{K_{a_{AH_3}}} \]</div>
<p>…thus we see that <span class="math notranslate nohighlight">\(k_{H} =  k_{AH_3} / K_{a_{AH_3^+}}\)</span> and the two values of <span class="math notranslate nohighlight">\(k_{AH_3}\)</span> and <span class="math notranslate nohighlight">\(K_{a_{AH_3}}\)</span> cannot be determined independantly unless we get to extreme acidities where we see the Arrhenius complex forming in the rate profile (we would need to see the curve leveling off to detect the value of <span class="math notranslate nohighlight">\(K_{a_{AH_3}}\)</span>.)</p>
</section>
<section id="a-note-on-k-a-ah-3">
<h3>A Note on <span class="math notranslate nohighlight">\(K_{a_{AH_3^+}}\)</span><a class="headerlink" href="#a-note-on-k-a-ah-3" title="Permalink to this heading">#</a></h3>
<p>The acidity of a protonated acetal is extreme and we are well outside of a pH range where <span class="math notranslate nohighlight">\([AH_3^+]\)</span> will be significant relative to the total amount of <span class="math notranslate nohighlight">\([A]\)</span>. How can we know this? The Bordwell <span class="math notranslate nohighlight">\(pK_a\)</span> table reports that the <span class="math notranslate nohighlight">\(pK_a\)</span> for a protonated ether is <span class="math notranslate nohighlight">\(-3.8\)</span>. An acetal will have an electron-withdrawing alkoxy group present so we can expect that the positively charged protonated form is even higher in energy and that the <span class="math notranslate nohighlight">\(pK_a\)</span> is more negative that <span class="math notranslate nohighlight">\(-3.8\)</span>. In the table I note that the <span class="math notranslate nohighlight">\(pK_a\)</span> of a protonated ketone and a protonated methy ester are <span class="math notranslate nohighlight">\(-3.1\)</span> and <span class="math notranslate nohighlight">\(-3.9\)</span> respectively. The electron-withrawing alkoxy group increased the acidity by almost a whole <span class="math notranslate nohighlight">\(pH\)</span> unit. In that example there would still be some resononce stabilization via the lone pair on the oxygen. In the case of an acetal there would be no resonance donation, only inductive electron withdrawal. So I expect that the difference between a protonated ether and a protonated acetal would be greater than in the case of a protonated ketone compared to an protonated ester.</p>
<p>My conclusion is that the <span class="math notranslate nohighlight">\(pK_a\)</span> value for a protonated acetal is much more neagtive than <span class="math notranslate nohighlight">\(-3.8\)</span> and since we are in acidities less that <span class="math notranslate nohighlight">\(pH = 0\)</span> we can safely ignore <span class="math notranslate nohighlight">\(AH_3^+\)</span> in the total concentration for all species of <span class="math notranslate nohighlight">\(A\)</span>.</p>
<p>You can check the Bordwell table yourself at https://organicchemistrydata.org/hansreich/resources/pka/</p>
</section>
</section>
<section id="load-the-data">
<h2>Load the Data<a class="headerlink" href="#load-the-data" title="Permalink to this heading">#</a></h2>
<p>Let use load in the data set we obtained from the kinetic runs. in the code below we will import the data and plot the values of <span class="math notranslate nohighlight">\(k_1\)</span> v pH.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#######################</span>
<span class="c1">### Environment Setup and Global Variables</span>
<span class="c1">#######################</span>

<span class="n">github</span> <span class="o">=</span> <span class="kc">True</span>

<span class="o">!</span>mkdir<span class="w"> </span>plots

<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>uncertainties
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>lmfit

<span class="k">if</span> <span class="n">github</span><span class="p">:</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/blinkletter/4410PythonNotebooks/main/Class_11/data/&quot;</span>
    <span class="n">image_path</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/blinkletter/4410PythonNotebooks/main/Class_11/images/&quot;</span>
    <span class="n">github_data_location</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/blinkletter/LFER-QSAR/main/data/&quot;</span>
    <span class="n">github_styles_location</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/blinkletter/LFER-QSAR/main/styles/&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;../Class_11/data/&quot;</span>
    <span class="n">image_path</span> <span class="o">=</span> <span class="s2">&quot;../Class_11/images/&quot;</span>
    <span class="n">github_data_location</span> <span class="o">=</span> <span class="s2">&quot;/Users/blink/github/LFER-QSAR/data/&quot;</span>
    <span class="n">github_styles_location</span> <span class="o">=</span> <span class="s2">&quot;/Users/blink/github/LFER-QSAR/styles/&quot;</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mkdir: plots: File exists
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">uncertainties</span> <span class="k">as</span> <span class="nn">un</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="kn">import</span> <span class="n">unumpy</span> <span class="k">as</span> <span class="n">unp</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;results.csv&quot;</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;pH&quot;</span><span class="p">]</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;k1 value&quot;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;k1 stdev&quot;</span><span class="p">])</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>

<span class="n">y1n</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">y1s</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\log{(k_1\ /s^{-1})}$ &quot;</span><span class="p">,</span> 
       <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$pH$&quot;</span><span class="p">,</span>                
       <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">7.1</span><span class="p">],</span>                  
<span class="c1">#       ylim=[-0.03,0.65]</span>
       <span class="p">)</span>

<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1n</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1n</span><span class="p">,</span> <span class="n">y1s</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">elinewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1">### Output plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/06A_Kirby2_data_k1.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plot of log(kobs) vs pH data only. NO curve fit&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data obtained by curve fits of UV-vis abs vs time kinetic runs&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error bars are 10X standard deviation (so that they are visible&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  and can be better compared&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     pH  k1 value      k1 stdev  k2 value      k2 stdev
0  0.00  0.001093  5.753888e-05  0.000657  1.606151e-05
1  0.28  0.000491  1.287954e-05  0.000292  3.557540e-06
2  0.55  0.000235  4.175846e-06  0.000129  1.008008e-06
3  1.00  0.000134  2.166825e-06  0.000061  3.929983e-07
4  1.25  0.000068  6.729857e-07  0.000034  1.368019e-07
</pre></div>
</div>
<img alt="../../../_images/8c22071636b1c0a717220167376d7d3e4691f646e75eb0409c35ab0baffaafa9.png" src="../../../_images/8c22071636b1c0a717220167376d7d3e4691f646e75eb0409c35ab0baffaafa9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plot of log(kobs) vs pH data only. NO curve fit
Data obtained by curve fits of UV-vis abs vs time kinetic runs
Error bars are 10X standard deviation (so that they are visible
  and can be better compared
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-the-function">
<h2>Define the Function<a class="headerlink" href="#define-the-function" title="Permalink to this heading">#</a></h2>
<p>For a curve fit we must first create a function that takes the x-axis values and parameters and returns the y-values. We can then use an experimental set of x and y-values to find the parameters that give a best fit. First let us plot the data from our values for <span class="math notranslate nohighlight">\(k_1\)</span> vs pH against a line calculated using parameters from table 2 in the paper.</p>
<p>We see that the fit is very close. But we will perform our own line fit eventually anyway.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Curve Fit</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">uncertainties</span> <span class="k">as</span> <span class="nn">un</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="kn">import</span> <span class="n">unumpy</span> <span class="k">as</span> <span class="n">unp</span>

<span class="k">def</span> <span class="nf">catalysis</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_AH2</span><span class="p">,</span> <span class="n">k_AH</span><span class="p">,</span> <span class="n">pKa_AH</span> <span class="o">=</span> <span class="mf">4.76</span><span class="p">,</span> <span class="n">pKa_AH2</span> <span class="o">=</span> <span class="mf">3.85</span><span class="p">):</span>

    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">Ka_AH2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH2</span><span class="p">)</span>  <span class="c1"># Ka for neutral species </span>
    <span class="n">Ka_AH</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH</span><span class="p">)</span>    <span class="c1"># Ka for monanion to give inactive dianion</span>

    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_H</span> <span class="o">*</span> <span class="n">H</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">k_AH2</span> <span class="o">*</span> <span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">k_AH</span> <span class="o">*</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span><span class="p">)</span> \
        <span class="o">/</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">Ka_AH</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>


<span class="n">pH_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">k_H</span> <span class="o">=</span> <span class="mf">9.2E-4</span>      <span class="c1"># rate for specific acid catalysis of AH2 species (protonated AH2)</span>
<span class="n">k_AH</span> <span class="o">=</span> <span class="mf">1.4E-3</span>     <span class="c1"># rate for monoanion species</span>
<span class="n">k_AH2</span> <span class="o">=</span> <span class="mf">3.7E-5</span>    <span class="c1"># rate for AH2 neutral species</span>

<span class="n">k_obs_paper_fit</span> <span class="o">=</span> <span class="n">catalysis</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_AH2</span><span class="p">,</span> <span class="n">k_AH</span><span class="p">)</span>
<span class="n">log_k_obs_paper_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs_paper_fit</span><span class="p">)</span>


<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\log{(k_1\ /s^{-1})}$ &quot;</span><span class="p">,</span> 
       <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$pH$&quot;</span><span class="p">,</span>                
       <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">7.1</span><span class="p">],</span>                  
<span class="c1">#       ylim=[-0.03,0.65]</span>
       <span class="p">)</span>

<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1n</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1n</span><span class="p">,</span> <span class="n">y1s</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">elinewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">log_k_obs_paper_fit</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>


<span class="c1">### Output plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/06B_Kirby2_data_k1_with_fit_using_paper_parameters.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plot of log(kobs) vs pH data only. NO curve fit&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data obtained by curve fits of UV-vis abs vs time kinetic runs&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Green line is calculated using parameters from paper for comparison&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/b4c17fc6e7f01d50e03edcb6c63d5ff445e2505056c08c06c315b3d9730d94c3.png" src="../../../_images/b4c17fc6e7f01d50e03edcb6c63d5ff445e2505056c08c06c315b3d9730d94c3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plot of log(kobs) vs pH data only. NO curve fit
Data obtained by curve fits of UV-vis abs vs time kinetic runs
Green line is calculated using parameters from paper for comparison
</pre></div>
</div>
</div>
</div>
</section>
<section id="curve-fit">
<h2>Curve Fit<a class="headerlink" href="#curve-fit" title="Permalink to this heading">#</a></h2>
<p>Here we will use lmfit to fit the data to the model and see if we get values close to those reported by the authors.  We will also see if our calculated standard deviations are similar.</p>
<p>This is a three-parameter fit using fixed values for <span class="math notranslate nohighlight">\(pKa_{AH2} = 4.76\)</span> and <span class="math notranslate nohighlight">\(pKa_{AH} = 3.85\)</span>. When we use weights based on the standard deviations we see that there is a significant deviation in our line fit from the authors fit. However when we remove the weights (comment out the line of code that set the weights) we get a very close match.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># x is pH, y1n is data (s-1) and y1s is stdevs</span>

<span class="kn">import</span> <span class="nn">lmfit</span>     
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">uncertainties</span> <span class="k">as</span> <span class="nn">un</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="kn">import</span> <span class="n">unumpy</span> <span class="k">as</span> <span class="n">unp</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s2">&quot;results.csv&quot;</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;pH&quot;</span><span class="p">]</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;k1 value&quot;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;k1 stdev&quot;</span><span class="p">])</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>

<span class="n">y1n</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">y1s</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">catalysis</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_AH2</span><span class="p">,</span> <span class="n">k_AH</span><span class="p">):</span>

    <span class="n">pKa_AH</span> <span class="o">=</span> <span class="mf">4.76</span>
    <span class="n">pKa_AH2</span> <span class="o">=</span> <span class="mf">3.85</span>
    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">Ka_AH2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH2</span><span class="p">)</span>  <span class="c1"># Ka for neutral species </span>
    <span class="n">Ka_AH</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH</span><span class="p">)</span>    <span class="c1"># Ka for monanion to give inactive dianion</span>

    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_H</span> <span class="o">*</span> <span class="n">H</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">k_AH2</span> <span class="o">*</span> <span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">k_AH</span> <span class="o">*</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span><span class="p">)</span> \
        <span class="o">/</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">Ka_AH</span><span class="p">)</span>
    
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="c1">##########################</span>
<span class="c1">### use lmfit to fit data to function </span>
<span class="c1">##########################</span>

<span class="n">pKa_AH</span> <span class="o">=</span> <span class="mf">4.76</span>
<span class="n">pKa_AH2</span> <span class="o">=</span> <span class="mf">3.85</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">y1n</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">y1s</span>
<span class="n">pH</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;pH&quot;</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pH</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">catalysis</span><span class="p">,</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s1">&#39;omit&#39;</span><span class="p">)</span>  <span class="c1"># load the function f as the model to be fit</span>

                                    <span class="c1"># state the parameters (use the text strings that we used above in sympy)</span>
<span class="n">pars</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">k_H</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">9.24E-4</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">k_AH2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">1.4E-3</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">k_AH</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">3.7E-5</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">pKa_AH</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">4.76</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="mi">7</span><span class="p">),</span>
                       <span class="n">pKa_AH2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">3.85</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="mi">7</span><span class="p">),</span>
                       <span class="p">)</span>    <span class="c1"># initial values are also set here</span>
                                    
<span class="n">result</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">pH</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                 <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">ys</span>
                 <span class="p">)</span>  <span class="c1"># Use the .fit method on the model object to perform the curve fit</span>
                                <span class="c1"># the variable in this function is &#39;t&#39; so we must use that in the call</span>
<span class="c1">##########################</span>
<span class="c1">### get the results </span>
<span class="c1">##########################</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fit_report</span><span class="p">())</span>

<span class="n">k_H_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k_H&#39;</span><span class="p">]</span>
<span class="n">k_AH2_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k_AH2&#39;</span><span class="p">]</span>
<span class="n">k_AH_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k_AH&#39;</span><span class="p">]</span>
<span class="c1">#</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(k_H) = </span><span class="si">{</span><span class="n">k_H_fit</span><span class="si">:</span><span class="s2">0.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(k_AH2) = </span><span class="si">{</span><span class="n">k_AH2_fit</span><span class="si">:</span><span class="s2">0.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(k_AH) = </span><span class="si">{</span><span class="n">k_AH_fit</span><span class="si">:</span><span class="s2">0.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">pH_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="n">l_k_obs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">pH</span><span class="o">=</span><span class="n">pH_array</span><span class="p">)</span>
<span class="n">devs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval_uncertainty</span><span class="p">(</span><span class="n">pH</span><span class="o">=</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">residual</span>

<span class="n">y_fit</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">l_k_obs</span><span class="p">,</span><span class="n">devs</span><span class="p">)</span>
<span class="c1">#log_y = unp.log10(y_fit)</span>
<span class="n">log_y</span> <span class="o">=</span> <span class="n">y_fit</span>

<span class="n">y_values</span> <span class="o">=</span> <span class="n">l_k_obs</span>


<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\log{(k_1\ /s^{-1})}$ &quot;</span><span class="p">,</span> 
       <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$pH$&quot;</span><span class="p">,</span>                
       <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">7.1</span><span class="p">],</span>                  
       <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">5.5</span><span class="p">,</span><span class="o">-</span><span class="mf">2.5</span><span class="p">]</span>
       <span class="p">)</span>

<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ys</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">elinewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">#### Create Confidence band upper and lower bounds</span>
<span class="c1">######################</span>

<span class="c1"># upper and lower bounds of uncertain kobs as float values</span>
<span class="n">fit_up</span> <span class="o">=</span> <span class="n">y_values</span> <span class="o">+</span> <span class="n">devs</span>
<span class="n">fit_dn</span> <span class="o">=</span> <span class="n">y_values</span> <span class="o">-</span> <span class="n">devs</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">fit_up</span><span class="p">,</span> <span class="n">fit_dn</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">### Plot the residuals</span>
<span class="c1">######################</span>

<span class="c1"># difference between data and line-fit</span>
<span class="c1">#residuals = -result.residual      </span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">result</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">pH</span><span class="o">=</span><span class="n">pH</span><span class="p">)</span>      
<span class="nb">print</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          title = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Residuals&quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="p">,</span>                
          <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">7.1</span><span class="p">],</span>                  
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="o">+</span><span class="mf">0.2</span><span class="p">]</span>
       <span class="p">)</span>
<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">ys</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">elinewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">devs</span><span class="p">,</span> <span class="o">-</span><span class="n">devs</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>

<span class="c1">####################################################</span>
<span class="c1">### Calculate and Plot Components</span>
<span class="c1">####################################################</span>

<span class="k">def</span> <span class="nf">kH_component</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_AH2</span><span class="p">,</span> <span class="n">k_AH</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="p">):</span>
    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">Ka_AH2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH2</span><span class="p">)</span>  <span class="c1"># Ka for neutral species </span>
    <span class="n">Ka_AH</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH</span><span class="p">)</span>    <span class="c1"># Ka for monanion to give inactive dianion</span>
    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_H</span> <span class="o">*</span> <span class="n">H</span><span class="o">**</span><span class="mi">3</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">Ka_AH</span><span class="p">)</span>
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">kAH_component</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_AH2</span><span class="p">,</span> <span class="n">k_AH</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="p">):</span>
    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">Ka_AH2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH2</span><span class="p">)</span>  <span class="c1"># Ka for neutral species </span>
    <span class="n">Ka_AH</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH</span><span class="p">)</span>    <span class="c1"># Ka for monanion to give inactive dianion</span>
    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_AH2</span> <span class="o">*</span> <span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">Ka_AH</span><span class="p">)</span> 
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">kAH2_component</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_AH2</span><span class="p">,</span> <span class="n">k_AH</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="p">):</span>
    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">Ka_AH2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH2</span><span class="p">)</span>  <span class="c1"># Ka for neutral species </span>
    <span class="n">Ka_AH</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH</span><span class="p">)</span>    <span class="c1"># Ka for monanion to give inactive dianion</span>
    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_AH</span> <span class="o">*</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">Ka_AH</span><span class="p">)</span>    
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pKa_AH2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
              <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pKa_AH</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
              <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">kH_line</span> <span class="o">=</span> <span class="n">kH_component</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">k_H_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">kH_line</span><span class="p">,</span> 
           <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
           <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">kAH_line</span> <span class="o">=</span> <span class="n">kAH_component</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">k_H_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">kAH_line</span><span class="p">,</span> 
           <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
           <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">kAH2_line</span> <span class="o">=</span> <span class="n">kAH2_component</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">k_H_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">kAH2_line</span><span class="p">,</span> 
           <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
           <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>




<span class="c1">####################################################</span>
<span class="c1">### Plot original author&#39;s line on main plot and in residuals</span>
<span class="c1">####################################################</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">log_k_obs_paper_fit</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">log_k_obs_paper_fit</span> <span class="o">-</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">### Output plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/06B_Kirby2_data_k1_with_fit_using_paper_parameters.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fit of log(kobs) vs pH with weights&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pKas are fixed. Fit for kH, kAH, kAH2&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Green line is calculated using parameters from paper&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     pH  k1 value      k1 stdev  k2 value      k2 stdev
0  0.00  0.001093  5.753888e-05  0.000657  1.606151e-05
1  0.28  0.000491  1.287954e-05  0.000292  3.557540e-06
2  0.55  0.000235  4.175846e-06  0.000129  1.008008e-06
3  1.00  0.000134  2.166825e-06  0.000061  3.929983e-07
4  1.25  0.000068  6.729857e-07  0.000034  1.368019e-07
[[Model]]
    Model(catalysis)
[[Fit Statistics]]
    # fitting method   = leastsq
    # function evals   = 25
    # data points      = 19
    # variables        = 3
    chi-square         = 1332.76669
    reduced chi-square = 83.2979184
    Akaike info crit   = 86.7608928
    Bayesian info crit = 89.5942097
    R-squared          = 0.98622043
[[Variables]]
    k_H:    6.5411e-04 +/- 8.1567e-05 (12.47%) (init = 0.000924)
    k_AH2:  4.3476e-05 +/- 3.3654e-06 (7.74%) (init = 0.0014)
    k_AH:   0.00139687 +/- 5.1297e-05 (3.67%) (init = 3.7e-05)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(k_H, k_AH2)  = -0.5923
    C(k_AH2, k_AH) = -0.3560
    C(k_H, k_AH)   = +0.1600
(k_H) = (6.5411+/-0.8157)e-04
(k_AH2) = (4.3476+/-0.3365)e-05
(k_AH) = (1.3969+/-0.0513)e-03
[ 0.19488431  0.10326832  0.01283366  0.08301798 -0.08645084 -0.01492184
  0.00437118  0.01362371  0.04187327 -0.07860377 -0.01871601 -0.01157644
  0.00897351  0.00023625 -0.04361637 -0.0047825   0.04879589 -0.00550658
 -0.01585784]
</pre></div>
</div>
<img alt="../../../_images/8e4819098382e47889132f7a29c81ff26a8e3ce1985e338c1432504600e762c8.png" src="../../../_images/8e4819098382e47889132f7a29c81ff26a8e3ce1985e338c1432504600e762c8.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit of log(kobs) vs pH with weights
pKas are fixed. Fit for kH, kAH, kAH2
Green line is calculated using parameters from paper
</pre></div>
</div>
</div>
</div>
<section id="line-fit-with-weights">
<h3>Line Fit with Weights<a class="headerlink" href="#line-fit-with-weights" title="Permalink to this heading">#</a></h3>
<p>This is a five-parameter line fit and I used the standard deviations of the data set to weight the data. You can see this fits close to the values reported by the authors with significant deviations. All deviations are within the 95% confidence band. This hints that the authors did not used weights in their data analysis (maybe).</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># x is pH, y1n is data (s-1) and y1s is stdevs</span>

<span class="kn">import</span> <span class="nn">lmfit</span>     
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">uncertainties</span> <span class="k">as</span> <span class="nn">un</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="kn">import</span> <span class="n">unumpy</span> <span class="k">as</span> <span class="n">unp</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s2">&quot;results.csv&quot;</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;pH&quot;</span><span class="p">]</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;k1 value&quot;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;k1 stdev&quot;</span><span class="p">])</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>

<span class="n">y1n</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">y1s</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">catalysis</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_AH2</span><span class="p">,</span> <span class="n">k_AH</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="p">):</span>

    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">Ka_AH2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH2</span><span class="p">)</span>  <span class="c1"># Ka for neutral species </span>
    <span class="n">Ka_AH</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH</span><span class="p">)</span>    <span class="c1"># Ka for monanion to give inactive dianion</span>

    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_H</span> <span class="o">*</span> <span class="n">H</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">k_AH2</span> <span class="o">*</span> <span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">k_AH</span> <span class="o">*</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span><span class="p">)</span> \
        <span class="o">/</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">Ka_AH</span><span class="p">)</span>
    
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="c1">##########################</span>
<span class="c1">### use lmfit to fit data to function </span>
<span class="c1">##########################</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">y1n</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">y1s</span>
<span class="n">pH</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;pH&quot;</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pH</span>

<span class="c1">#y = y1n[2:]</span>
<span class="c1">#ys = y1s[2:]</span>
<span class="c1">#pH = df[&quot;pH&quot;]</span>
<span class="c1">#x = pH[2:]</span>



<span class="n">mod</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">catalysis</span><span class="p">,</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s1">&#39;omit&#39;</span><span class="p">)</span>  <span class="c1"># load the function f as the model to be fit</span>

                                    <span class="c1"># state the parameters (use the text strings that we used above in sympy)</span>
<span class="n">pars</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">k_H</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">9.24E-4</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">k_AH2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">1.4E-3</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">k_AH</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">3.7E-5</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">pKa_AH</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">4.76</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="mi">7</span><span class="p">),</span>
                       <span class="n">pKa_AH2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">3.85</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="mi">7</span><span class="p">),</span>
                       <span class="p">)</span>    <span class="c1"># initial values are also set here</span>
                                    
<span class="n">result</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">pH</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                 <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">ys</span><span class="p">)</span>  <span class="c1"># Use the .fit method on the model object to perform the curve fit</span>
                                <span class="c1"># the variable in this function is &#39;t&#39; so we must use that in the call</span>
<span class="c1">##########################</span>
<span class="c1">### get the results </span>
<span class="c1">##########################</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fit_report</span><span class="p">())</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">ci_report</span><span class="p">())</span>
<span class="nb">print</span><span class="p">()</span>


<span class="n">k_H_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k_H&#39;</span><span class="p">]</span>
<span class="n">k_AH2_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k_AH2&#39;</span><span class="p">]</span>
<span class="n">k_AH_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k_AH&#39;</span><span class="p">]</span>
<span class="n">pKa_AH2</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;pKa_AH2&#39;</span><span class="p">]</span>
<span class="n">pKa_AH</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;pKa_AH&#39;</span><span class="p">]</span>
<span class="c1">#</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log k_H = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_H_fit</span><span class="p">)</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log k_AH2 = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_AH2_fit</span><span class="p">)</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log k_AH = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_AH_fit</span><span class="p">)</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pKa_AH2 = </span><span class="si">{</span><span class="n">pKa_AH2</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pKa_AH = </span><span class="si">{</span><span class="n">pKa_AH</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ka_AH2 = </span><span class="si">{</span><span class="mi">10</span><span class="o">**-</span><span class="n">pKa_AH2</span><span class="si">:</span><span class="s2">0.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ka_AH = </span><span class="si">{</span><span class="mi">10</span><span class="o">**-</span><span class="n">pKa_AH</span><span class="si">:</span><span class="s2">0.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">pH_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="n">log_y</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">pH</span><span class="o">=</span><span class="n">pH_array</span><span class="p">)</span>
<span class="n">devs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval_uncertainty</span><span class="p">(</span><span class="n">pH</span><span class="o">=</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1">### y_fit = unp.uarray(k_obs,devs)</span>
<span class="c1">### log_y = k_obs</span>
<span class="c1">### </span>
<span class="c1">### y_values = unp.nominal_values(log_y)</span>
<span class="c1">### y_stdev = unp.std_devs(log_y)</span>


<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\log{(k_1\ /s^{-1})}$ &quot;</span><span class="p">,</span> 
       <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$pH$&quot;</span><span class="p">,</span>                
       <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">7.1</span><span class="p">],</span>                  
       <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">5.5</span><span class="p">,</span><span class="o">-</span><span class="mf">2.5</span><span class="p">]</span>
       <span class="p">)</span>

<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ys</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">elinewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">log_y</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">#### Create Confidence band upper and lower bounds</span>
<span class="c1">######################</span>

<span class="c1"># upper and lower bounds of uncertain kobs as float values</span>
<span class="n">fit_up</span> <span class="o">=</span> <span class="n">log_y</span> <span class="o">+</span> <span class="n">devs</span>
<span class="n">fit_dn</span> <span class="o">=</span> <span class="n">log_y</span> <span class="o">-</span> <span class="n">devs</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">fit_up</span><span class="p">,</span> <span class="n">fit_dn</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">### Plot the residuals</span>
<span class="c1">######################</span>

<span class="c1"># difference between data and line-fit</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">residual</span>      
<span class="n">residuals</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">result</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">pH</span><span class="o">=</span><span class="n">pH</span><span class="p">)</span>      
<span class="nb">print</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          title = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Residuals&quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="p">,</span>                
          <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">7.1</span><span class="p">],</span>                  
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="o">+</span><span class="mf">0.2</span><span class="p">]</span>
       <span class="p">)</span>
<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">ys</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">elinewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">devs</span><span class="p">,</span> <span class="o">-</span><span class="n">devs</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>

<span class="c1">####################################################</span>
<span class="c1">### Calculate and Plot Components</span>
<span class="c1">####################################################</span>

<span class="k">def</span> <span class="nf">kH_component</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_AH2</span><span class="p">,</span> <span class="n">k_AH</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="p">):</span>
    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">Ka_AH2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH2</span><span class="p">)</span>  <span class="c1"># Ka for neutral species </span>
    <span class="n">Ka_AH</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH</span><span class="p">)</span>    <span class="c1"># Ka for monanion to give inactive dianion</span>
    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_H</span> <span class="o">*</span> <span class="n">H</span><span class="o">**</span><span class="mi">3</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">Ka_AH</span><span class="p">)</span>
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">kAH_component</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_AH2</span><span class="p">,</span> <span class="n">k_AH</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="p">):</span>
    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">Ka_AH2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH2</span><span class="p">)</span>  <span class="c1"># Ka for neutral species </span>
    <span class="n">Ka_AH</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH</span><span class="p">)</span>    <span class="c1"># Ka for monanion to give inactive dianion</span>
    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_AH2</span> <span class="o">*</span> <span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">Ka_AH</span><span class="p">)</span> 
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">kAH2_component</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_AH2</span><span class="p">,</span> <span class="n">k_AH</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="p">):</span>
    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">Ka_AH2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH2</span><span class="p">)</span>  <span class="c1"># Ka for neutral species </span>
    <span class="n">Ka_AH</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH</span><span class="p">)</span>    <span class="c1"># Ka for monanion to give inactive dianion</span>
    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_AH</span> <span class="o">*</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">Ka_AH</span><span class="p">)</span>    
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pKa_AH2</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
              <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pKa_AH</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
              <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">kH_line</span> <span class="o">=</span> <span class="n">kH_component</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">k_H_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">kH_line</span><span class="p">,</span> 
           <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
           <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">kAH_line</span> <span class="o">=</span> <span class="n">kAH_component</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">k_H_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">kAH_line</span><span class="p">,</span> 
           <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
           <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">kAH2_line</span> <span class="o">=</span> <span class="n">kAH2_component</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">k_H_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">kAH2_line</span><span class="p">,</span> 
           <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
           <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>




<span class="c1">####################################################</span>
<span class="c1">### Plot original author&#39;s line on main plot and in residuals</span>
<span class="c1">####################################################</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">log_k_obs_paper_fit</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">log_k_obs_paper_fit</span> <span class="o">-</span> <span class="n">log_y</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">### Output plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/06B_Kirby2_data_k1_with_fit_using_paper_parameters.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fit of log(kobs) vs pH with weights&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fit for kH, kAH2, kAH, pKaAH2, pKaAH&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Green line is calculated using parameters from paper&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     pH  k1 value      k1 stdev  k2 value      k2 stdev
0  0.00  0.001093  5.753888e-05  0.000657  1.606151e-05
1  0.28  0.000491  1.287954e-05  0.000292  3.557540e-06
2  0.55  0.000235  4.175846e-06  0.000129  1.008008e-06
3  1.00  0.000134  2.166825e-06  0.000061  3.929983e-07
4  1.25  0.000068  6.729857e-07  0.000034  1.368019e-07
[[Model]]
    Model(catalysis)
[[Fit Statistics]]
    # fitting method   = leastsq
    # function evals   = 87
    # data points      = 19
    # variables        = 5
    chi-square         = 1189.52936
    reduced chi-square = 84.9663825
    Akaike info crit   = 88.6006066
    Bayesian info crit = 93.3228014
    R-squared          = 0.98800684
[[Variables]]
    k_H:      6.9463e-04 +/- 9.3241e-05 (13.42%) (init = 0.000924)
    k_AH2:    3.9415e-05 +/- 5.0158e-06 (12.73%) (init = 0.0014)
    k_AH:     0.00114667 +/- 1.6158e-04 (14.09%) (init = 3.7e-05)
    pKa_AH:   4.85847006 +/- 0.07367570 (1.52%) (init = 4.76)
    pKa_AH2:  3.69931738 +/- 0.10097179 (2.73%) (init = 3.85)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(k_AH, pKa_AH)    = -0.9521
    C(k_AH, pKa_AH2)   = +0.8884
    C(pKa_AH, pKa_AH2) = -0.8423
    C(k_H, k_AH2)      = -0.6879
    C(k_AH2, pKa_AH2)  = +0.6080
    C(k_H, pKa_AH2)    = -0.3542
    C(k_AH2, k_AH)     = +0.3265
    C(k_AH2, pKa_AH)   = -0.3058
    C(k_H, k_AH)       = -0.1864
    C(k_H, pKa_AH)     = +0.1745

            99.73%    95.45%    68.27%    _BEST_    68.27%    95.45%    99.73%
 k_H    :  -0.00029  -0.00018  -0.00009   0.00069  +0.00010  +0.00022  +0.00038
 k_AH2  :  -0.00002  -0.00001  -0.00001   0.00004  +0.00001  +0.00001  +0.00002
 k_AH   :  -0.00042  -0.00029  -0.00016   0.00115  +0.00020  +0.00053  +0.00121
 pKa_AH :  -0.35591  -0.19132  -0.08415   4.85847  +0.07636  +0.15497  +0.24562
 pKa_AH2:  -0.35483  -0.22372  -0.10993   3.69932  +0.11950  +0.26772  +0.48439

log k_H = -3.1582+/-0.0583
log k_AH2 = -4.4043+/-0.0553
log k_AH = -2.9406+/-0.0612
pKa_AH2 = 3.6993+/-0.1010
pKa_AH = 4.8585+/-0.0737

Ka_AH2 = (1.9984+/-0.4646)e-04
Ka_AH = (1.3853+/-0.2350)e-05
[ 0.17277309  0.08436875 -0.00104876  0.08205999 -0.0796507  -0.00304831
  0.01299926  0.00846652  0.02179825 -0.0909337  -0.01131848  0.02151044
  0.04994807  0.03483137 -0.02419167 -0.00387927  0.04201759 -0.0162823
 -0.02781245]
</pre></div>
</div>
<img alt="../../../_images/e53c2549c1a4c034ac2d92edcee76ec9e528293dc61d067ee21e982d2a1ce38a.png" src="../../../_images/e53c2549c1a4c034ac2d92edcee76ec9e528293dc61d067ee21e982d2a1ce38a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fit of log(kobs) vs pH with weights
Fit for kH, kAH2, kAH, pKaAH2, pKaAH
Green line is calculated using parameters from paper
</pre></div>
</div>
</div>
</div>
</section>
<section id="line-fit-with-no-weights">
<h3>Line Fit with No Weights<a class="headerlink" href="#line-fit-with-no-weights" title="Permalink to this heading">#</a></h3>
<p>This is a five-parameter line fit but I did not use the standard deviations of the data set to weight the data. You can see this fits very close to the values reported by the authors and show that the author also did not use weights in their line fit (maybe). It would have been nice if <em>Python</em> had been invented in 2000 and the authors could have used it to present their work in an interactive notebook (invented in 2014)</p>
<p><em>(Python 2.0 was released in the year 2000 and interactive Python was released in 2001. MatPlotLib was released in 2003 and many of the tools that we used were developed later than that. So we can’t blame anyone for not using Jupyter Notebooks. But I am calling 2024 the cut-off-date on that. It’s time to always document your data analysis.)</em></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># No weights used</span>

<span class="c1"># x is pH, y1n is data (s-1) and y1s is stdevs</span>

<span class="kn">import</span> <span class="nn">lmfit</span>  
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1">#df = pd.read_csv(&quot;data/Fig1-Kirby2002_data.csv&quot;, skipinitialspace=True, comment=&quot;#&quot;)</span>
<span class="c1">#print(df.head())</span>

<span class="c1">#df2 = df[[&quot;pH&quot;,&quot;k_1&quot;]].dropna()</span>
<span class="c1">#print(df2.head())</span>

<span class="c1">#x = df[&quot;pH&quot;]</span>
<span class="c1">#y = df[&quot;k_1&quot;]*1E-5</span>
<span class="c1">#log_y = np.log10(y)</span>

<span class="kn">import</span> <span class="nn">lmfit</span>     
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">uncertainties</span> <span class="k">as</span> <span class="nn">un</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="kn">import</span> <span class="n">unumpy</span> <span class="k">as</span> <span class="n">unp</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s2">&quot;results.csv&quot;</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;pH&quot;</span><span class="p">]</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;k1 value&quot;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;k1 stdev&quot;</span><span class="p">])</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>

<span class="n">y1n</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">y1s</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;k1 value&quot;</span><span class="p">]</span>
<span class="n">log_y</span> <span class="o">=</span> <span class="n">y1n</span>

<span class="k">def</span> <span class="nf">catalysis</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_AH2</span><span class="p">,</span> <span class="n">k_AH</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="p">):</span>

    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">Ka_AH2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH2</span><span class="p">)</span>  <span class="c1"># Ka for neutral species </span>
    <span class="n">Ka_AH</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH</span><span class="p">)</span>    <span class="c1"># Ka for monanion to give inactive dianion</span>

    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_H</span> <span class="o">*</span> <span class="n">H</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">k_AH2</span> <span class="o">*</span> <span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">k_AH</span> <span class="o">*</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span><span class="p">)</span> \
        <span class="o">/</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">Ka_AH</span><span class="p">)</span>
    
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="c1">##########################</span>
<span class="c1">### use lmfit to fit data to function </span>
<span class="c1">##########################</span>




<span class="n">mod</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">catalysis</span><span class="p">,</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s1">&#39;omit&#39;</span><span class="p">)</span>  <span class="c1"># load the function f as the model to be fit</span>

                                    <span class="c1"># state the parameters (use the text strings that we used above in sympy)</span>
<span class="n">pars</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">k_H</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">9.24E-4</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">k_AH2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">1.4E-3</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">k_AH</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">3.7E-5</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">pKa_AH</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">4.76</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="mi">7</span><span class="p">),</span>
                       <span class="n">pKa_AH2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">3.85</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="mi">7</span><span class="p">),</span>
                       <span class="p">)</span>    <span class="c1"># initial values are also set here</span>
                                    
<span class="n">result</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">log_y</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">pH</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Use the .fit method on the model object to perform the curve fit</span>
                                <span class="c1"># the variable in this function is &#39;t&#39; so we must use that in the call</span>
<span class="c1">##########################</span>
<span class="c1">### get the results </span>
<span class="c1">##########################</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fit_report</span><span class="p">())</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">ci_report</span><span class="p">())</span>
<span class="nb">print</span><span class="p">()</span>

<span class="n">k_H_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k_H&#39;</span><span class="p">]</span>
<span class="n">k_AH2_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k_AH2&#39;</span><span class="p">]</span>
<span class="n">k_AH_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k_AH&#39;</span><span class="p">]</span>
<span class="n">pKa_AH2</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;pKa_AH2&#39;</span><span class="p">]</span>
<span class="n">pKa_AH</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;pKa_AH&#39;</span><span class="p">]</span>
<span class="c1">#</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log k_H = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_H_fit</span><span class="p">)</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log k_AH2 = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_AH2_fit</span><span class="p">)</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log k_AH = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_AH_fit</span><span class="p">)</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pKa_AH2 = </span><span class="si">{</span><span class="n">pKa_AH2</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pKa_AH = </span><span class="si">{</span><span class="n">pKa_AH</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">pH_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="n">log_y_calc</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">pH</span><span class="o">=</span><span class="n">pH_array</span><span class="p">)</span>
<span class="n">devs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval_uncertainty</span><span class="p">(</span><span class="n">pH</span><span class="o">=</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\log{(k_1\ /s^{-1})}$ &quot;</span><span class="p">,</span> 
       <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$pH$&quot;</span><span class="p">,</span>                
       <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">7.1</span><span class="p">],</span>                  
       <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">5.5</span><span class="p">,</span><span class="o">-</span><span class="mf">2.5</span><span class="p">]</span>
       <span class="p">)</span>

<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">log_y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">log_y_calc</span><span class="p">,</span> 
           <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> 
           <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">#### Create Confidence band upper and lower bounds</span>
<span class="c1">######################</span>

<span class="c1"># upper and lower bounds of uncertain kobs as float values</span>
<span class="n">fit_up</span> <span class="o">=</span> <span class="n">log_y_calc</span> <span class="o">+</span> <span class="n">devs</span>
<span class="n">fit_dn</span> <span class="o">=</span> <span class="n">log_y_calc</span> <span class="o">-</span> <span class="n">devs</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">fit_up</span><span class="p">,</span> <span class="n">fit_dn</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">### Plot the residuals</span>
<span class="c1">######################</span>

<span class="c1"># difference between data and line-fit</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">residual</span>      

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          title = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Residuals&quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="p">,</span>                
          <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">7.1</span><span class="p">],</span>                  
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="o">+</span><span class="mf">0.2</span><span class="p">]</span>
       <span class="p">)</span>
<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">devs</span><span class="p">,</span> <span class="o">-</span><span class="n">devs</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>

<span class="c1">####################################################</span>
<span class="c1">### Calculate and Plot Components</span>
<span class="c1">####################################################</span>

<span class="k">def</span> <span class="nf">kH_component</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_AH2</span><span class="p">,</span> <span class="n">k_AH</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="p">):</span>
    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">Ka_AH2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH2</span><span class="p">)</span>  <span class="c1"># Ka for neutral species </span>
    <span class="n">Ka_AH</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH</span><span class="p">)</span>    <span class="c1"># Ka for monanion to give inactive dianion</span>
    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_H</span> <span class="o">*</span> <span class="n">H</span><span class="o">**</span><span class="mi">3</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">Ka_AH</span><span class="p">)</span>
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">kAH_component</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_AH2</span><span class="p">,</span> <span class="n">k_AH</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="p">):</span>
    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">Ka_AH2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH2</span><span class="p">)</span>  <span class="c1"># Ka for neutral species </span>
    <span class="n">Ka_AH</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH</span><span class="p">)</span>    <span class="c1"># Ka for monanion to give inactive dianion</span>
    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_AH2</span> <span class="o">*</span> <span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">Ka_AH</span><span class="p">)</span> 
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">kAH2_component</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_AH2</span><span class="p">,</span> <span class="n">k_AH</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="p">):</span>
    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">Ka_AH2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH2</span><span class="p">)</span>  <span class="c1"># Ka for neutral species </span>
    <span class="n">Ka_AH</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pKa_AH</span><span class="p">)</span>    <span class="c1"># Ka for monanion to give inactive dianion</span>
    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_AH</span> <span class="o">*</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="n">Ka_AH2</span> <span class="o">*</span> <span class="n">Ka_AH</span><span class="p">)</span>    
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pKa_AH2</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
              <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pKa_AH</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
              <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">kH_line</span> <span class="o">=</span> <span class="n">kH_component</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">k_H_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">kH_line</span><span class="p">,</span> 
           <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
           <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">kAH_line</span> <span class="o">=</span> <span class="n">kAH_component</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">k_H_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">kAH_line</span><span class="p">,</span> 
           <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
           <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">kAH2_line</span> <span class="o">=</span> <span class="n">kAH2_component</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">k_H_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_AH_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">pKa_AH</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">pKa_AH2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">kAH2_line</span><span class="p">,</span> 
           <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
           <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>




<span class="c1">####################################################</span>
<span class="c1">### Plot original author&#39;s line on main plot and in residuals</span>
<span class="c1">####################################################</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">log_k_obs_paper_fit</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">log_k_obs_paper_fit</span> <span class="o">-</span> <span class="n">log_y_calc</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>


<span class="c1">### Output plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/06B_Kirby2_data_k1_with_fit_using_paper_data.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fit of log(kobs) vs pH with NO weights&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fit for kH, kAH2, kAH, pKaAH2, pKaAH&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Green line is calculated using parameters from paper&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     pH  k1 value      k1 stdev  k2 value      k2 stdev
0  0.00  0.001093  5.753888e-05  0.000657  1.606151e-05
1  0.28  0.000491  1.287954e-05  0.000292  3.557540e-06
2  0.55  0.000235  4.175846e-06  0.000129  1.008008e-06
3  1.00  0.000134  2.166825e-06  0.000061  3.929983e-07
4  1.25  0.000068  6.729857e-07  0.000034  1.368019e-07
[[Model]]
    Model(catalysis)
[[Fit Statistics]]
    # fitting method   = leastsq
    # function evals   = 106
    # data points      = 19
    # variables        = 5
    chi-square         = 0.04231028
    reduced chi-square = 0.00302216
    Akaike info crit   = -106.036120
    Bayesian info crit = -101.313925
    R-squared          = 0.99239743
[[Variables]]
    k_H:      8.5493e-04 +/- 6.8871e-05 (8.06%) (init = 0.000924)
    k_AH2:    3.5794e-05 +/- 6.1138e-06 (17.08%) (init = 0.0014)
    k_AH:     0.00124743 +/- 1.7649e-04 (14.15%) (init = 3.7e-05)
    pKa_AH:   4.81609074 +/- 0.07783363 (1.62%) (init = 4.76)
    pKa_AH2:  3.76626364 +/- 0.11760135 (3.12%) (init = 3.85)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(k_AH, pKa_AH)    = -0.9391
    C(k_AH, pKa_AH2)   = +0.8785
    C(pKa_AH, pKa_AH2) = -0.8157
    C(k_H, k_AH2)      = -0.5377
    C(k_AH2, pKa_AH2)  = +0.5282
    C(k_AH2, k_AH)     = +0.3133
    C(k_AH2, pKa_AH)   = -0.2850
    C(k_H, pKa_AH2)    = -0.2368
    C(k_H, k_AH)       = -0.1380
    C(k_H, pKa_AH)     = +0.1256

            99.73%    95.45%    68.27%    _BEST_    68.27%    95.45%    99.73%
 k_H    :  -0.00022  -0.00014  -0.00007   0.00085  +0.00007  +0.00016  +0.00028
 k_AH2  :  -0.00002  -0.00001  -0.00001   0.00004  +0.00001  +0.00001  +0.00002
 k_AH   :  -0.00045  -0.00032  -0.00017   0.00125  +0.00023  +0.00061  +0.00145
 pKa_AH :  -0.39201  -0.20734  -0.09044   4.81609  +0.08123  +0.16412  +0.25902
 pKa_AH2:  -0.43627  -0.27271  -0.13262   3.76626  +0.14071  +0.31115  +0.55737

log k_H = -3.0681+/-0.0350
log k_AH2 = -4.4462+/-0.0742
log k_AH = -2.9040+/-0.0614
pKa_AH2 = 3.7663+/-0.1176
pKa_AH = 4.8161+/-0.0778
</pre></div>
</div>
<img alt="../../../_images/9aabfd08cd2c10b885a29b96dd469230a53f35013cea634c5b78c0476512de19.png" src="../../../_images/9aabfd08cd2c10b885a29b96dd469230a53f35013cea634c5b78c0476512de19.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fit of log(kobs) vs pH with NO weights
Fit for kH, kAH2, kAH, pKaAH2, pKaAH
Green line is calculated using parameters from paper
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="ph-rate-profiles-for-k-2">
<h2>pH-rate Profiles for <span class="math notranslate nohighlight">\(k_2\)</span><a class="headerlink" href="#ph-rate-profiles-for-k-2" title="Permalink to this heading">#</a></h2>
<p>All of the above again for the other set of pH-rate data.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># x is pH, y1n is data (s-1) and y1s is stdevs</span>

<span class="kn">import</span> <span class="nn">lmfit</span>     
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">uncertainties</span> <span class="k">as</span> <span class="nn">un</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="kn">import</span> <span class="n">unumpy</span> <span class="k">as</span> <span class="n">unp</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;results.csv&quot;</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>

<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;k2 value&quot;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;k2 stdev&quot;</span><span class="p">])</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">y1n</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">y1s</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">catalysis</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_H2O</span><span class="p">,</span> <span class="n">k_OH</span><span class="p">):</span>

    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">KW</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="mf">13.038</span>   <span class="c1"># KW at 60 deg c - authors used 10**-13.034</span>
<span class="c1">#    KW = 10**-14   # KW at 60 deg c</span>

    <span class="n">k_obs</span> <span class="o">=</span> <span class="n">k_H</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="n">k_H2O</span> <span class="o">+</span> <span class="n">k_OH</span> <span class="o">*</span> <span class="n">KW</span> <span class="o">/</span> <span class="n">H</span> 
    
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="c1">##########################</span>
<span class="c1">### use lmfit to fit data to function </span>
<span class="c1">##########################</span>

<span class="n">pH</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;pH&quot;</span><span class="p">]</span>

<span class="c1">#y = y1n[2:]; ys = y1s[2:]; pH = pH[2:]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y1n</span><span class="p">;</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">y1s</span><span class="p">;</span> <span class="n">pH</span> <span class="o">=</span> <span class="n">pH</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">pH</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">catalysis</span><span class="p">,</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s1">&#39;omit&#39;</span><span class="p">)</span>  <span class="c1"># load the function f as the model to be fit</span>

                                    <span class="c1"># state the parameters (use the text strings that we used above in sympy)</span>
<span class="n">pars</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">k_H</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">5E-3</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">k_H2O</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">5E-6</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">k_OH</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="p">)</span>    <span class="c1"># initial values are also set here</span>
                                    
<span class="n">result</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">pH</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                 <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">ys</span>
             <span class="p">)</span>                 <span class="c1"># Use the .fit method on the model object to perform the curve fit</span>
                                <span class="c1"># the variable in this function is &#39;t&#39; so we must use that in the call</span>
<span class="c1">##########################</span>
<span class="c1">### get the results </span>
<span class="c1">##########################</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fit_report</span><span class="p">())</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">ci_report</span><span class="p">())</span>
<span class="nb">print</span><span class="p">()</span>


<span class="n">k_H_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k_H&#39;</span><span class="p">]</span>
<span class="n">k_H2O_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k_H2O&#39;</span><span class="p">]</span>
<span class="n">k_OH_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k_OH&#39;</span><span class="p">]</span>
<span class="c1">#</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log k_H = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_H_fit</span><span class="p">)</span><span class="si">:</span><span class="s2">0.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log k_H2O = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_H2O_fit</span><span class="p">)</span><span class="si">:</span><span class="s2">0.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log k_OH = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_OH_fit</span><span class="p">)</span><span class="si">:</span><span class="s2">0.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">pH_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="n">pH_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">k_Hp</span> <span class="o">=</span> <span class="mf">4.6E-4</span>      <span class="c1"># rate for specific acid catalysis of AH2 species (protonated AH2)</span>
<span class="n">k_H2Op</span> <span class="o">=</span> <span class="mf">3.5E-6</span>     <span class="c1"># rate for monoanion species</span>
<span class="n">k_OHp</span> <span class="o">=</span> <span class="mi">250</span>    <span class="c1"># rate for AH2 neutral species</span>

<span class="n">log_k_obs_paper_fit</span> <span class="o">=</span> <span class="n">catalysis</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">k_Hp</span><span class="p">,</span> <span class="n">k_H2Op</span><span class="p">,</span> <span class="n">k_OHp</span><span class="p">)</span>


<span class="n">log_y</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">pH</span><span class="o">=</span><span class="n">pH_array</span><span class="p">)</span>
<span class="n">devs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval_uncertainty</span><span class="p">(</span><span class="n">pH</span><span class="o">=</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\log{(k_1\ /s^{-1})}$ &quot;</span><span class="p">,</span> 
       <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$pH$&quot;</span><span class="p">,</span>                
       <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">7.1</span><span class="p">],</span>                  
       <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
       <span class="p">)</span>

<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ys</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">elinewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">log_y</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">#### Create Confidence band upper and lower bounds</span>
<span class="c1">######################</span>

<span class="c1"># upper and lower bounds of uncertain kobs as float values</span>
<span class="n">fit_up</span> <span class="o">=</span> <span class="n">log_y</span> <span class="o">+</span> <span class="n">devs</span>
<span class="n">fit_dn</span> <span class="o">=</span> <span class="n">log_y</span> <span class="o">-</span> <span class="n">devs</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">fit_up</span><span class="p">,</span> <span class="n">fit_dn</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">### Plot the residuals</span>
<span class="c1">######################</span>

<span class="c1"># difference between data and line-fit</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">residual</span>      
<span class="n">residuals</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">result</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">pH</span><span class="o">=</span><span class="n">pH</span><span class="p">)</span>      
<span class="nb">print</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          title = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Residuals&quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="p">,</span>                
          <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">7.1</span><span class="p">],</span>                  
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="o">+</span><span class="mf">0.2</span><span class="p">]</span>
       <span class="p">)</span>
<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">ys</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">elinewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">devs</span><span class="p">,</span> <span class="o">-</span><span class="n">devs</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>

<span class="c1">####################################################</span>
<span class="c1">### Calculate and Plot Components</span>
<span class="c1">####################################################</span>

<span class="k">def</span> <span class="nf">kH_component</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_H2O</span><span class="p">,</span> <span class="n">k_OH</span><span class="p">):</span>
    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_H</span> <span class="o">*</span> <span class="n">H</span><span class="p">)</span>
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">kH2O_component</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_H2O</span><span class="p">,</span> <span class="n">k_OH</span><span class="p">):</span>
    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">[</span><span class="n">k_H2O</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">kOH_component</span><span class="p">(</span><span class="n">pH</span><span class="p">,</span> <span class="n">k_H</span><span class="p">,</span> <span class="n">k_H2O</span><span class="p">,</span> <span class="n">k_OH</span><span class="p">):</span>
    <span class="n">H</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
    <span class="n">KW</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="mf">13.038</span>   <span class="c1"># KW at 60 degC - authors used 10**-13.034</span>
<span class="c1">#    KW = 10**-14</span>
    <span class="n">k_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_OH</span> <span class="o">*</span> <span class="n">KW</span> <span class="o">/</span> <span class="n">H</span><span class="p">)</span>   
    <span class="n">log_k_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k_obs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">log_k_obs</span><span class="p">)</span>

<span class="n">kH_line</span> <span class="o">=</span> <span class="n">kH_component</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">k_H_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_H2O_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_OH_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">kH_line</span><span class="p">,</span> 
           <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
           <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">kH2O_line</span> <span class="o">=</span> <span class="n">kH2O_component</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">k_H_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_H2O_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_OH_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">kH2O_line</span><span class="p">,</span> 
           <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
           <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">kOH_line</span> <span class="o">=</span> <span class="n">kOH_component</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">k_H_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_H2O_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k_OH_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">kOH_line</span><span class="p">,</span> 
           <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
           <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>




<span class="c1">####################################################</span>
<span class="c1">### Plot original author&#39;s line on main plot and in residuals</span>
<span class="c1">####################################################</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">log_k_obs_paper_fit</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pH_array</span><span class="p">,</span> <span class="n">log_k_obs_paper_fit</span> <span class="o">-</span> <span class="n">log_y</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">### Output plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/06B_Kirby2_data_k2_with_fit_using_paper_parameters.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fit of log(kobs) vs pH with weights&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fit for kH, kAH2, kAH, pKaAH2, pKaAH&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Green line is calculated using parameters from paper&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[Model]]
    Model(catalysis)
[[Fit Statistics]]
    # fitting method   = leastsq
    # function evals   = 25
    # data points      = 19
    # variables        = 3
    chi-square         = 12008.0729
    reduced chi-square = 750.504555
    Akaike info crit   = 128.529014
    Bayesian info crit = 131.362331
    R-squared          = 0.99220625
[[Variables]]
    k_H:    4.4984e-04 +/- 2.9064e-05 (6.46%) (init = 0.005)
    k_H2O:  3.4804e-06 +/- 2.1768e-07 (6.25%) (init = 5e-06)
    k_OH:   245.824769 +/- 19.8030793 (8.06%) (init = 500)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(k_H2O, k_OH) = -0.4017
    C(k_H, k_H2O)  = -0.3020
    C(k_H, k_OH)   = +0.1202

          99.73%    95.45%    68.27%    _BEST_    68.27%    95.45%    99.73%
 k_H  :  -0.00009  -0.00006  -0.00003   0.00045  +0.00003  +0.00007  +0.00011
 k_H2O:  -0.00000  -0.00000  -0.00000   0.00000  +0.00000  +0.00000  +0.00000
 k_OH : -64.26225 -40.74188 -19.96997 245.82477 +21.08071 +45.64818 +77.37706

log k_H = (-3.3469+/-0.0281)e+00
log k_H2O = (-5.4584+/-0.0272)e+00
log k_OH = (2.3906+/-0.0350)e+00
[ 0.16123214  0.08564793 -0.00282202  0.10218737  0.06749534 -0.04145513
 -0.05482639 -0.05482874  0.00614851  0.01660874 -0.00929754 -0.03874573
 -0.00306264  0.10212979 -0.02501584 -0.04058497  0.03546152 -0.01164488
 -0.03642781]
</pre></div>
</div>
<img alt="../../../_images/dd8f8980df191fd787557a7a4cfc1b0cec6e609f6bfba099dc0b66b1303fd55a.png" src="../../../_images/dd8f8980df191fd787557a7a4cfc1b0cec6e609f6bfba099dc0b66b1303fd55a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fit of log(kobs) vs pH with weights
Fit for kH, kAH2, kAH, pKaAH2, pKaAH
Green line is calculated using parameters from paper
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://srd.nist.gov/JPCRD/jpcrd181.pdf</span>
<span class="c1"># https://www.chemguide.co.uk/physical/acidbaseeqia/kw.html</span>
<span class="c1"># </span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">linregress</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>


<span class="c1">################################################################################</span>
<span class="c1">### Read data set. The fields are separated by commas; comments are enabled  ###</span>
<span class="c1">################################################################################</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s2">&quot;water_density2.csv&quot;</span><span class="p">,</span> 
                 <span class="n">delimiter</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> 
                 <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
<span class="c1">#                 index_col=&quot;pH&quot;, </span>
                 <span class="n">comment</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span> 
<span class="c1">#display(df.head())</span>


<span class="c1"># Data from https://www.chemguide.co.uk/physical/acidbaseeqia/kw.html</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>  
<span class="n">T</span> <span class="o">=</span> <span class="n">T</span> <span class="o">+</span> <span class="mi">273</span>
<span class="n">Kw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.114e-14</span><span class="p">,</span>
    <span class="mf">0.293E-14</span><span class="p">,</span>
    <span class="mf">0.681E-14</span><span class="p">,</span>
    <span class="mf">1.008E-14</span><span class="p">,</span>
    <span class="mf">1.471E-14</span><span class="p">,</span>
    <span class="mf">2.916E-14</span><span class="p">,</span>
    <span class="mf">5.476E-14</span><span class="p">,</span>
    <span class="mf">51.3E-14</span>
<span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Kw</span><span class="p">),</span> <span class="s2">&quot;ko&quot;</span><span class="p">)</span>

<span class="c1"># Empirical equation from https://srd.nist.gov/JPCRD/jpcrd181.pdf</span>
<span class="n">A</span> <span class="o">=</span> <span class="o">-</span><span class="mf">4.098</span>
<span class="n">B</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3245.2</span>
<span class="n">C</span> <span class="o">=</span> <span class="mf">2.2362E5</span>
<span class="n">D</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.984E7</span>
<span class="n">E</span> <span class="o">=</span> <span class="mf">13.957</span>
<span class="n">F</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1262.3</span>
<span class="n">G</span> <span class="o">=</span> <span class="mf">8.5641E5</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;temp degC&quot;</span><span class="p">]</span><span class="o">+</span><span class="mi">273</span>
<span class="n">pw</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;d g/cm&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>
<span class="n">logKwCalcNIST</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span><span class="o">/</span><span class="n">T</span> <span class="o">+</span> <span class="n">C</span><span class="o">/</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">D</span><span class="o">/</span><span class="n">T</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="n">F</span><span class="o">/</span><span class="n">T</span> <span class="o">+</span> <span class="n">G</span><span class="o">/</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pw</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">T</span><span class="p">),</span><span class="n">logKwCalcNIST</span><span class="p">,</span> <span class="s2">&quot;r-&quot;</span><span class="p">)</span>

<span class="n">Temp</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">T</span><span class="o">=</span><span class="n">Temp</span><span class="o">+</span><span class="mi">273</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;temp degC&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">Temp</span><span class="p">]</span>  <span class="c1"># get line from dataframe</span>
<span class="n">pw</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s2">&quot;d g/cm&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>              <span class="c1"># get single series from that line</span>
<span class="n">pw</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>                <span class="c1"># convert single item in series to float</span>

<span class="n">logKwCalcNIST</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span><span class="o">/</span><span class="n">T</span> <span class="o">+</span> <span class="n">C</span><span class="o">/</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">D</span><span class="o">/</span><span class="n">T</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="n">F</span><span class="o">/</span><span class="n">T</span> <span class="o">+</span> <span class="n">G</span><span class="o">/</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pw</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log Kw at 60 deg is </span><span class="si">{</span><span class="n">logKwCalcNIST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>log Kw at 60 deg is -13.0378336182295
</pre></div>
</div>
<img alt="../../../_images/78b6831f9e3e7e1ae9a421abd2406c35353a26a9e022d81a8743651d05ed3012.png" src="../../../_images/78b6831f9e3e7e1ae9a421abd2406c35353a26a9e022d81a8743651d05ed3012.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Class_11/_build/jupyter_execute"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2-part-6-ph-rate-profile-example-kirby-2002">Example 2, Part 6: pH-Rate Profile Example - Kirby 2002</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-equation">The Equation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-equations-as-used-by-the-authors">The Equations as Used by the Authors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-note-on-k-h">A Note on <span class="math notranslate nohighlight">\(k_H\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-note-on-k-a-ah-3">A Note on <span class="math notranslate nohighlight">\(K_{a_{AH_3^+}}\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-the-data">Load the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-function">Define the Function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#curve-fit">Curve Fit</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#line-fit-with-weights">Line Fit with Weights</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#line-fit-with-no-weights">Line Fit with No Weights</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ph-rate-profiles-for-k-2">pH-rate Profiles for <span class="math notranslate nohighlight">\(k_2\)</span></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Barry Linkletter
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>