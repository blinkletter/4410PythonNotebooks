

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>2.5 Data Analysis &#8212; Chem 4410 Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tufte.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Class_11/05-Kirby2_DataAnalysis_OLD';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../start.html">
  
  
  
  
  
  
    <p class="title logo__title">Chem 4410 Python</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../start.html">
                    Chem 4410 Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Thermochemistry</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Class_05/Group_Increments_Class_Handout_Discussion-Problem1.html">Group Increments Handout Discussion - Problem 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_05/Group_Increments_Class_Handout_Discussion-Problem5.html">Group Increments Handout Discussion - Problems 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_05/Group_Increments_Class_Handout_Discussion-Problems2to4.html">Group Increments - Handout Discussion - Problems 2 to 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_05/Group_Increments_ClassExercises.html">Group Increments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_06/AValueClasshandoutDiscussion.html">07 Handout A-Value Calculations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Acid and Bases</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Class_08/Correlations.html">Plotting Related <span class="math notranslate nohighlight">\(pK_a\)</span> Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_08/CurveSmoothAndInterpolate.html">Data Smoothing and Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_08/H0_Data.html">Acidity Function Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_08/HNO3_Acidity_Function_Calcs.html">Lesson #3, Meeting #8, Class Problem #1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_08/HNO3_Acidity_Function.html">HNO<sub>3</sub> Acidity Function Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_08/LookAheadToKinetics.html">A Look Ahead to Kinetics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_08/Question5_13.html">Chapter 5, Question 13</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Aspirin Hydrolysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Class_10/aspirin_notebook_with_uncertainty.html">Aspirin Hydrolysis Curve Fits</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Kirby Enzyme Models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01-Kirby2_PlotEqsFromPaper.html">1: The Literature Equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-Kirby2_PlotEqsFromPaper.html">2: The Correct Equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-Kirby2_PlotEqsFromPaper.html">3: Integrating the Rate Laws</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-Kirby2_PlotEqsFromPaper.html">4: Numeric Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="05-Kirby2_DataAnalysis.html">5: Abs vs Time Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-Kirby2_DataAnalysis.html">6: pH-Rate Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="04X-Kirby2_PlotEqsFromPaper.html">X: Creating Data Sets</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">LFER 1</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Class_14/Table_4_Plots.html">Data Sets from the Literature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_14/Table_5_Plots.html">Data Sets from the Literature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_14/Table_6_Plots.html"><span class="math notranslate nohighlight">\(\sigma\)</span> and <span class="math notranslate nohighlight">\(\sigma ^+\)</span> Plots</a></li>

<li class="toctree-l1"><a class="reference internal" href="../Class_14/Table_7_Plots_with_YukawaTsuno.html">Data Sets from the Literature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_14/Table_7_Plots.html">Data Sets from the Literature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_14/Table1and2_ClassExamples.html">Class Discussion Data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">LFER 2</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Class_15/15-BrownOkamoto_Python_Notebook.html">The Browm-Okamoto Plot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_15/15-YukawaTsunoFitNotebook.html">Yukawa-Tsuno Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_16/16_Class_Handout_Problems_OLd.html">Class handout Questions and Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_16/16_Class_Handout_Problems.html">Class Handout: Interpretting Table 1 and Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_16/16-EstroneSyn.html">Curved Plot Example</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">LFER 3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Class_17/17-ClassExample-table1and3.html">Taft Plot Investigations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_17/17-ClassExample-table3.html">Taft Plot Investigations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_17/17-ClassExample-table4and5.html">Taft Plot Investigations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Explorations 1</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Class_21/21-Beckman-1.html">Beckmann rate Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_21/21-Beckman-2.html">Beckmann rate Data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Explorations 2</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Class_23/23-1b_calculator.html">Calculating <span class="math notranslate nohighlight">\(k_{A,R}\)</span> for 1b</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_23/23-AutoFit.html">pH-rate Data AutoFitter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_23/23-Figure2Paper_Hammett_Acid_Rate.html">Figure 4: Hammett Plot for pH = 11.5 (<span class="math notranslate nohighlight">\(\log{k_{H^+}}\)</span> vs <span class="math notranslate nohighlight">\(\sigma\)</span>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_23/23-Figure3Paper_Hammett_Uncat_Rate.html">Figure 4: Hammett Plot for pH = 1.0 (<span class="math notranslate nohighlight">\(\log{k_{H^+}}\)</span> vs <span class="math notranslate nohighlight">\(\sigma\)</span>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_23/23-Figure4Paper_Hammett_Acid_Rate.html">Figure 4: Hammett Plot for pH = 1.0 (<span class="math notranslate nohighlight">\(\log{k_{H^+}}\)</span> vs <span class="math notranslate nohighlight">\(\sigma\)</span>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_23/23-Hammett_Acid_Rate.html">Hammett Plot for pH = 1.0 (<span class="math notranslate nohighlight">\(\log{k_{H^+}}\)</span> vs <span class="math notranslate nohighlight">\(\sigma\)</span>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_23/23-Hammett_Base_Rate.html">Hammett Plot for pH = 11.5 (<span class="math notranslate nohighlight">\(\log{k_{OH^-}}\)</span> vs <span class="math notranslate nohighlight">\(\sigma\)</span>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_23/23-Hammett_Water_Rate.html">Hammett Plot for pH = 3.8 (<span class="math notranslate nohighlight">\(\log{k_{H_2O}}\)</span> vs <span class="math notranslate nohighlight">\(\sigma\)</span>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_23/23-pH_profile_fit.html">pH-rate Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_23/23-pH_Profiles_AutoFit_kHKa.html">pH-rate Data AutoFitter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_23/23-pH_Profiles_AutoFit.html">pH-rate Data AutoFitter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_23/23-pHprofilefor1f.html">pH-rate Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_23/23-ResultsTableCalculations.html">Calculations for Results Tables</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Explorations 3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Class_30/01A-ActivityOfWaterinH2SO4byWt.html">Activity of water (<span class="math notranslate nohighlight">\(a_{H_2O}\)</span>) vs. <span class="math notranslate nohighlight">\(X_{H_2SO_4}\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/01B-ActivityOfWaterinH2SO4byX.html">Activity of water (<span class="math notranslate nohighlight">\(a_{H_2O}\)</span>) vs. <span class="math notranslate nohighlight">\(\text{\%wt }{H_2SO_4}\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/02_H2SO4_PercentWt_to_H0.html">Combined <span class="math notranslate nohighlight">\(H_0\)</span> Table</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/03_H2SO4_Percent_Density_Molarity.html">Combined <span class="math notranslate nohighlight">\(\% H_2SO_4\)</span> Table for Density and Molarity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/03_H2SO4_PercentWt_to_MolarConc.html">Data Smoothing and Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/04_Cook_1975_HR_Values_Smooth.html">Data Smoothing and Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/04_H0_HR_Comparison.html">Comparison of <span class="math notranslate nohighlight">\(H-0\)</span> data and <span class="math notranslate nohighlight">\(H_R\)</span> data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/interpolators_check.html">Interpolation Tools Quality Check</a></li>

<li class="toctree-l1"><a class="reference internal" href="../Class_30/Yates-interpolators.html">Interpolation of data tables</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Explorations 3 Yates</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Class_30/Yates-Fig5-HRH0.html">A Plot of <span class="math notranslate nohighlight">\(H_R\)</span> vs. <span class="math notranslate nohighlight">\(H_0\)</span></a></li>

<li class="toctree-l1"><a class="reference internal" href="../Class_30/Yates-Fig5-HRH0%2BinterpolatorsH0HR-Patches.html">A Plot of <span class="math notranslate nohighlight">\(H_R\)</span> vs. <span class="math notranslate nohighlight">\(H_0\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/Yates-Fig6-MeOAc.html">A Plot of <span class="math notranslate nohighlight">\(k_{obs}\)</span> vs. <span class="math notranslate nohighlight">\(\%H_2SO_4\)</span> or <span class="math notranslate nohighlight">\(H_0\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/Yates-Fig7-MeOAc.html">A Plot of <span class="math notranslate nohighlight">\(k_{obs}\)</span> vs. <span class="math notranslate nohighlight">\(\%H_2SO_4\)</span> or <span class="math notranslate nohighlight">\(H_0\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/Yates-Fig8-rate_vs_aH2O.html">A Plot of <span class="math notranslate nohighlight">\(k_{obs}\)</span> vs. <span class="math notranslate nohighlight">\(a_{H_2O}\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/Yates-Fig10-rate_vs_gammaH2O.html">A Plot of <span class="math notranslate nohighlight">\(k_{obs}\)</span> vs. <span class="math notranslate nohighlight">\(\gamma [H_2O]\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/Yates-Fig13-rate_vs_gammaH2O.html">A Plot of <span class="math notranslate nohighlight">\(k_{obs}\)</span> vs. <span class="math notranslate nohighlight">\(\gamma [H_2O]\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/Yates-Fig15-rate_vs_aH2O.html">A Plot of <span class="math notranslate nohighlight">\(k_{obs}\)</span> vs. <span class="math notranslate nohighlight">\(\%H_2SO_4\)</span> or <span class="math notranslate nohighlight">\(H_0\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/Yates-Fig20-rate_vs_aH2O.html">A Plot of <span class="math notranslate nohighlight">\(k_{obs}\)</span> vs. <span class="math notranslate nohighlight">\(\%H_2SO_4\)</span> or <span class="math notranslate nohighlight">\(H_0\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/Yates-Fig23-rate_vs_aH2O.html">A Plot of <span class="math notranslate nohighlight">\(k_{obs}\)</span> vs. <span class="math notranslate nohighlight">\(\%H_2SO_4\)</span> or <span class="math notranslate nohighlight">\(H_0\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Class_30/Yates-FigX-rate_vs_aH2O.html">A Plot of <span class="math notranslate nohighlight">\(k_{obs}\)</span> vs. <span class="math notranslate nohighlight">\(\%H_2SO_4\)</span> or <span class="math notranslate nohighlight">\(H_0\)</span></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extras</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Class_09/CatenaryCurve.html">The Hammond Postulate and Rope</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/blinkletter/4410PythonNotebooks/blob/main/./Class_11/05-Kirby2_DataAnalysis_OLD.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/blinkletter/4410PythonNotebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Class_11/05-Kirby2_DataAnalysis_OLD.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>2.5 Data Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2-part-5-ph-rate-profile-example-kirby-2002">Example 2, Part 5: pH-Rate Profile Example - Kirby 2002</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-equations">The equations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-data">Plot the Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#many-plots">Many Plots</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#curve-fit-to-1st-order">Curve Fit to 1st Order</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#curve-fitting-the-model">Curve Fitting the Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-same-thing-again-again">The Same Thing Again &amp; Again</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-ph-rate-profile">The pH-rate profile</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-your-results">Examine Your Results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#change-the-results">Change the Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-best-fit">The Best Fit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-the-wrong-equation">Extra: The Wrong Equation</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="data-analysis">
<h1>2.5 Data Analysis<a class="headerlink" href="#data-analysis" title="Permalink to this heading">#</a></h1>
<section id="example-2-part-5-ph-rate-profile-example-kirby-2002">
<h2>Example 2, Part 5: pH-Rate Profile Example - Kirby 2002<a class="headerlink" href="#example-2-part-5-ph-rate-profile-example-kirby-2002" title="Permalink to this heading">#</a></h2>
<p>Tony Kirby is one of the giants of physical organic and bio-organic chemistry. In this paper he follows up on a decades-long series of papers investigating the mechanism of <em>amylases</em> that catalyze the hydrolysis of acetal groups in polysaccharide chains.</p>
<p>``Concerted general acid and nucleophilic catalysis of acetalhydrolysis. A simple model for the lysozyme mechanism’’. K.E.S. Deana, A.J. Kirby, <em>J. Chem. Soc., Perkin Trans. 2</em>, <strong>2002</strong>, 428-432. https://doi.org/10.1039/B110948K.</p>
<p>This <em>Python</em> notebook will curve fit the equation for absorbance vs time against kinetic data. We have a set of absorbance measured over 13 hours for 19 reaction performed at various pH values. We want to plot the pH rate profile (<span class="math notranslate nohighlight">\(\log{k_{obs}}\)</span> vs pH). First we must determine the rate constant. In this case there are <strong>two rate constants</strong> for two different reactions that produce product.</p>
</section>
<section id="the-equations">
<h2>The equations<a class="headerlink" href="#the-equations" title="Permalink to this heading">#</a></h2>
<p>For our reaction system…</p>
<div class="math notranslate nohighlight">
\[\text{A} \overset{k_1}{\longrightarrow} \text{I} + \text{P}\]</div>
<div class="math notranslate nohighlight">
\[\text{I} \overset{k_2}{\longrightarrow} \text{P}\]</div>
<p>…we state the following differential equations that describe the rate laws…</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
\dfrac{d\left[A\right]_t}{dt} &amp;= -k_1 \left[A\right]_t \\
\dfrac{d\left[I\right]_t}{dt} &amp;= k_1 \left[A\right]_t - k_2 \left[I\right]_t \\
\dfrac{d\left[P\right]_t}{dt} &amp;= k_1 \left[A\right]_t + k_2 \left[I\right]_t
\end{align*}
\end{split}\]</div>
<p>From this we derived the integrated rate laws and created equations that describe the concentration of each species w.r.t. time.</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}
\begin{align*}\\\begin{split}\left[A\right]_t &amp;= \left[A\right]_0 e^{-kt} \\
\left[I \right]_t &amp;= \left[A\right]_{0} \frac{ k_{1} }{k_{1} - k_{2}}\left(e^{- k_{2} t} - e^{- k_{1} t}\right) \\
\left[ P\right]_{t} &amp;= \left[A\right]_{0} \left(- \frac{k_{1} \left(e^{- k_{2} t} - e^{- k_{1} t}\right)}{k_{1} - k_{2}} + 2 - 2 e^{- k_{1} t}\right) \\\end{split}\\\end{align*}
\end{aligned}\end{align} \]</div>
<p>And we can obtain the absorbance contribution from each species using the initial absorbance (<span class="math notranslate nohighlight">\(Abs_0\)</span>) and the molar extinction coefficients for each species (<span class="math notranslate nohighlight">\(\epsilon_A\)</span>, <span class="math notranslate nohighlight">\(\epsilon_I\)</span>, and <span class="math notranslate nohighlight">\(\epsilon_P\)</span>)</p>
<div class="math notranslate nohighlight">
\[\text{Abs}_t = \text{Abs}_0 \left\{ e^{-k_1 t}
             + \frac{\epsilon_I}{\epsilon_A} \frac{k_1}{k_2-k_1}\left(e^{-k_1 t} - e^{-k_2 t} \right)
             + \frac{\epsilon_P}{\epsilon_A} \left[ 2 - 2 e^{-k_1 t} - \frac{k_1}{k_2-k_1}\left(e^{-k_1 t} - e^{-k_2 t}\right) \right] \right\}\]</div>
<p>This is the model to which we will fit the data. Beware! The equation reported in the paper contains typographical errors. The above equation is correct.</p>
</section>
<section id="the-data">
<h2>The Data<a class="headerlink" href="#the-data" title="Permalink to this heading">#</a></h2>
<p>The data is collected in a single csv file. We can open that file with a text editor, observe its format, and then write python code to import the data into a <em>Pandas</em> dataframe. The code below will import the data and display the dataframe.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#######################</span>
<span class="c1">### Environment Setup and Global Variables</span>
<span class="c1">#######################</span>

<span class="n">github</span> <span class="o">=</span> <span class="kc">False</span>

<span class="o">!</span>mkdir<span class="w"> </span>plots

<span class="c1">#!pip install uncertainties</span>
<span class="c1">#!pip install lmfit</span>

<span class="k">if</span> <span class="n">github</span><span class="p">:</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/blinkletter/4410PythonNotebooks/main/Class_11/data/&quot;</span>
    <span class="n">image_path</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/blinkletter/4410PythonNotebooks/main/Class_11/images/&quot;</span>
    <span class="n">github_data_location</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/blinkletter/LFER-QSAR/main/data/&quot;</span>
    <span class="n">github_styles_location</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/blinkletter/LFER-QSAR/main/styles/&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;../Class_11/data/&quot;</span>
    <span class="n">image_path</span> <span class="o">=</span> <span class="s2">&quot;../Class_11/images/&quot;</span>
    <span class="n">github_data_location</span> <span class="o">=</span> <span class="s2">&quot;/Users/blink/github/LFER-QSAR/data/&quot;</span>
    <span class="n">github_styles_location</span> <span class="o">=</span> <span class="s2">&quot;/Users/blink/github/LFER-QSAR/styles/&quot;</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mkdir: plots: File exists
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s2">&quot;Kirby2002/Abs_t_pH_ALL.csv&quot;</span><span class="p">,</span>
                <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span>
                <span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="n">time_column</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="c1"># get the column label for the first column (time)</span>
<span class="n">pH_values</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>     <span class="c1"># get the column labels that are the pH values</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time (hr)</th>
      <th>0.00</th>
      <th>0.28</th>
      <th>0.55</th>
      <th>1.00</th>
      <th>1.25</th>
      <th>1.50</th>
      <th>1.90</th>
      <th>2.25</th>
      <th>2.60</th>
      <th>3.40</th>
      <th>3.70</th>
      <th>4.10</th>
      <th>4.40</th>
      <th>4.75</th>
      <th>5.10</th>
      <th>5.60</th>
      <th>6.00</th>
      <th>6.50</th>
      <th>6.90</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.00</td>
      <td>0.2001</td>
      <td>0.2000</td>
      <td>0.2001</td>
      <td>0.2000</td>
      <td>0.2000</td>
      <td>0.1997</td>
      <td>0.1998</td>
      <td>0.2000</td>
      <td>0.2002</td>
      <td>0.2003</td>
      <td>0.1999</td>
      <td>0.1997</td>
      <td>0.2000</td>
      <td>0.2000</td>
      <td>0.1999</td>
      <td>0.2002</td>
      <td>0.1999</td>
      <td>0.2002</td>
      <td>0.2003</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.25</td>
      <td>0.1980</td>
      <td>0.1957</td>
      <td>0.1969</td>
      <td>0.1981</td>
      <td>0.1989</td>
      <td>0.1990</td>
      <td>0.1990</td>
      <td>0.1988</td>
      <td>0.1978</td>
      <td>0.1951</td>
      <td>0.1918</td>
      <td>0.1901</td>
      <td>0.1894</td>
      <td>0.1910</td>
      <td>0.1941</td>
      <td>0.1968</td>
      <td>0.1985</td>
      <td>0.1998</td>
      <td>0.1999</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.50</td>
      <td>0.2096</td>
      <td>0.1970</td>
      <td>0.1958</td>
      <td>0.1965</td>
      <td>0.1978</td>
      <td>0.1980</td>
      <td>0.1977</td>
      <td>0.1973</td>
      <td>0.1960</td>
      <td>0.1911</td>
      <td>0.1872</td>
      <td>0.1851</td>
      <td>0.1848</td>
      <td>0.1867</td>
      <td>0.1897</td>
      <td>0.1948</td>
      <td>0.1974</td>
      <td>0.1993</td>
      <td>0.1998</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.75</td>
      <td>0.2203</td>
      <td>0.2014</td>
      <td>0.1953</td>
      <td>0.1958</td>
      <td>0.1968</td>
      <td>0.1966</td>
      <td>0.1965</td>
      <td>0.1959</td>
      <td>0.1941</td>
      <td>0.1884</td>
      <td>0.1848</td>
      <td>0.1826</td>
      <td>0.1825</td>
      <td>0.1836</td>
      <td>0.1874</td>
      <td>0.1926</td>
      <td>0.1965</td>
      <td>0.1988</td>
      <td>0.1998</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.00</td>
      <td>0.2277</td>
      <td>0.2065</td>
      <td>0.1964</td>
      <td>0.1948</td>
      <td>0.1965</td>
      <td>0.1962</td>
      <td>0.1957</td>
      <td>0.1952</td>
      <td>0.1926</td>
      <td>0.1862</td>
      <td>0.1835</td>
      <td>0.1819</td>
      <td>0.1816</td>
      <td>0.1824</td>
      <td>0.1856</td>
      <td>0.1915</td>
      <td>0.1953</td>
      <td>0.1989</td>
      <td>0.1996</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="plot-the-data">
<h2>Plot the Data<a class="headerlink" href="#plot-the-data" title="Permalink to this heading">#</a></h2>
<p>Always do a quick visual check of your data. Perhaps its all noise? the code below will plot all the abs vs time traces in a single plot.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>                              <span class="c1">### resets the plot to defaults </span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>  

<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span>

<span class="k">for</span> <span class="n">pH</span> <span class="ow">in</span> <span class="n">pH_values</span><span class="p">:</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>             <span class="c1"># get absorbance values at a given pH</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>          <span class="c1"># draw a plot</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">markeredgewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> 
            <span class="n">markerfacecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">markeredgecolor</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>            <span class="c1">### use a line between points</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span>            <span class="c1">### make the line thin</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>            <span class="c1">### the line is black</span>
            <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span>                  <span class="c1">### everything is in layer 0 (the bottom layer in this case)</span>
            <span class="p">)</span>
    
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance\ /AU$&quot;</span><span class="p">,</span> 
        <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /\; hrs$&quot;</span><span class="p">,</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Abs. vs time&quot;</span><span class="p">,</span>
        <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>      
   <span class="c1">#     ylim=[-0.0, 0.105]</span>
   <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># otherwise the right y-label is slightly clipped</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/05_Kirby2_&quot;</span><span class="o">+</span><span class="s2">&quot;ALL&quot;</span><span class="o">+</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)</span>    <span class="c1"># use this to save the figure in PDF format</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/46eea70fb44c9d19630dde79f97b3d1d5a1eba89f01073f851b833615657774b.png" src="../_images/46eea70fb44c9d19630dde79f97b3d1d5a1eba89f01073f851b833615657774b.png" />
</div>
</div>
<section id="many-plots">
<h3>Many Plots<a class="headerlink" href="#many-plots" title="Permalink to this heading">#</a></h3>
<p>The code above placed all the lines in a single plot. Small changes can result in separate plots for each run. All that is changing is what commands are inside the loop or outside the loop. See if you can follow the differences and their effects.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>                              <span class="c1">### resets the plot to defaults </span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>  

<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span>

<span class="k">for</span> <span class="n">pH</span> <span class="ow">in</span> <span class="n">pH_values</span><span class="p">:</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>             <span class="c1"># get absorbance values at a given pH</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>          <span class="c1"># draw a plot</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">markeredgewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> 
            <span class="n">markerfacecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">markeredgecolor</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>            <span class="c1">### use a line between points</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span>            <span class="c1">### make the line thin</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>            <span class="c1">### the line is black</span>
            <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span>                  <span class="c1">### everything is in layer 0 (the bottom layer in this case)</span>
            <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance\ /AU$&quot;</span><span class="p">,</span> 
            <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /\; hrs$&quot;</span><span class="p">,</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Abs. vs time&quot;</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>      
            <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.175</span><span class="p">,</span> <span class="mf">0.245</span><span class="p">])</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># otherwise the right y-label is slightly clipped</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/stacking/05_Kirby2_Stacking_&quot;</span><span class="o">+</span><span class="n">pH</span><span class="o">+</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)</span>    <span class="c1"># use this to save the figure in PDF format</span>

<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>                              <span class="c1">### resets the plot to defaults </span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>


<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span>

<span class="k">for</span> <span class="n">pH</span> <span class="ow">in</span> <span class="n">pH_values</span><span class="p">:</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>             <span class="c1"># get absorbance values at a given pH</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>  

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>          <span class="c1"># draw a plot</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">markeredgewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> 
            <span class="n">markerfacecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">markeredgecolor</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>            <span class="c1">### use a line between points</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span>            <span class="c1">### make the line thin</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>            <span class="c1">### the line is black</span>
            <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span>                  <span class="c1">### everything is in layer 0 (the bottom layer in this case)</span>
            <span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">0.18</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;pH = </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance\ /AU$&quot;</span><span class="p">,</span> 
            <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /\; hrs$&quot;</span><span class="p">,</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Abs. vs time&quot;</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>      
            <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.175</span><span class="p">,</span> <span class="mf">0.245</span><span class="p">])</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># otherwise the right y-label is slightly clipped</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/single/05_Kirby2_Single_&quot;</span><span class="o">+</span><span class="n">pH</span><span class="o">+</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)</span>    <span class="c1"># use this to save the figure in PDF format</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>        <span class="c1"># close the plot and do not show it in the notebook</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="curve-fit-to-1st-order">
<h2>Curve Fit to 1st Order<a class="headerlink" href="#curve-fit-to-1st-order" title="Permalink to this heading">#</a></h2>
<p>Note: the authors inform us that only the very low pH runs fit a standard first-order integrated rate law. Let us model this anyway and see if that is what we observe.</p>
<p>The reaction could be considered to be a simple first order reaction that produces two products. This would be the case if <span class="math notranslate nohighlight">\(k_2 \gg k_1\)</span></p>
<p>So for The case…</p>
<div class="math notranslate nohighlight">
\[\text{A} \overset{k_{obs}}{\longrightarrow} 2 \text{P}\]</div>
<p>The absorbance change will be the addition of <span class="math notranslate nohighlight">\(Abs_A\)</span> and <span class="math notranslate nohighlight">\(Abs_P\)</span> and is derived as…</p>
<div class="math notranslate nohighlight">
\[\text{Abs}_t = \text{Abs}_0 \left\{ e^{-k_1 t}
             +2 \frac{\epsilon_P}{\epsilon_A} \left[ 1 -  e^{-k_1 t}  \right] \right\}\]</div>
<p>…which is the same as eq. 2 in the paper. Let us fit a set of experimental data to this equation. Consider the code below.</p>
<p>We can curve fit using the derived equation objects from sympy; we can curve fit using the numeric integration function; and we can curve fit a function that we create according to the know equation. this latter method is the simplest to code so that is what we will use.</p>
<p>It can be a problem to fit many variable. If there are variables that are strongly correlated we can end up with a situation where many very different solutions can give a satisfactory fit. We can also have systems that will not minimize as there is too large of a numerical space to explore in search of the minimum.</p>
<p>From previous work (one must go to a PhD thesis at Cambridge to get this data) we know that <span class="math notranslate nohighlight">\(\epsilon_P/\epsilon_A = 3.0\)</span> and we have deesigned the experiment in such a way that the initial concentrations of the reactant gives a value for <span class="math notranslate nohighlight">\(Abs_0 = 0.100 \)</span> AU. Now we only have to solve for <span class="math notranslate nohighlight">\(k_{obs}\)</span></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">lmfit</span>     
<span class="kn">import</span> <span class="nn">uncertainties</span> <span class="k">as</span> <span class="nn">un</span>               <span class="c1"># tool set for handling uncertainties</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="kn">import</span> <span class="n">unumpy</span> <span class="k">as</span> <span class="n">unp</span>  <span class="c1"># a replacement for numpy </span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="n">pH</span> <span class="o">=</span> <span class="n">pH_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>     <span class="c1"># choose one of the pH columns</span>
<span class="c1">#print(len(pH_values))</span>


<span class="k">def</span> <span class="nf">fit_u</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">):</span>

    <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
    <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span> <span class="o">*</span> <span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">eP</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)))</span>

    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      
    
<span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">):</span>

    <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
    <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">eP</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)))</span>

    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>

<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span>      <span class="c1"># time in seconds</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pH is </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1">##########################</span>
<span class="c1">### use lmfit to fit data to function </span>
<span class="c1">##########################</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s1">&#39;omit&#39;</span><span class="p">)</span>                  <span class="c1"># load the function f as the model to be fit</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;parameter names: </span><span class="si">{</span><span class="n">mod</span><span class="o">.</span><span class="n">param_names</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;independent variables: </span><span class="si">{</span><span class="n">mod</span><span class="o">.</span><span class="n">independent_vars</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                                    <span class="c1"># state the parameters (use the text strings that we used above in sympy)</span>
<span class="n">pars</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">k1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">))</span>    <span class="c1"># initial values are also set here</span>
                                    
<span class="n">result</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>            <span class="c1"># use the .fit method on the model object to perform the curve fit</span>
                                            <span class="c1"># the variable in this function is &#39;t&#39; so we must use that in the call</span>
<span class="c1">##########################</span>
<span class="c1">### get the results </span>
<span class="c1">##########################</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fit_report</span><span class="p">())</span>

<span class="n">k1_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;For pH </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">, log(k_obs) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k1_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">bestfit_y1</span> <span class="o">=</span> <span class="n">fit_u</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">k1_fit</span><span class="p">)</span>

<span class="c1">#######################################################################################</span>

<span class="c1">###############################################################################</span>
<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          teitle = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance$ &quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /s$&quot;</span><span class="p">,</span>                
<span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.65</span><span class="p">]</span>
       <span class="p">)</span>

<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 

<span class="c1"># Plot the curve fit line</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">),</span> 
           <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>


<span class="c1">######################</span>
<span class="c1">#### Create Confidence band upper and lower bounds</span>
<span class="c1">######################</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># upper and lower bounds of uncertain kobs as float values</span>
<span class="n">fit_up</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">+</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span>
<span class="n">fit_dn</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">-</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">fit_up</span><span class="p">,</span> <span class="n">fit_dn</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>


<span class="c1">######################</span>
<span class="c1">### Plot the residuals</span>
<span class="c1">######################</span>

<span class="c1"># difference between data and line-fit</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k1_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>      

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          title = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Residuals&quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="p">,</span>                
<span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">]</span>
       <span class="p">)</span>
<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="c1">### Other elements</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>


<span class="c1">### Output plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/05A_Kirby2_1stOrder.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pH is 0.28
parameter names: [&#39;k1&#39;]
independent variables: [&#39;t&#39;]
[[Model]]
    Model(fit)
[[Fit Statistics]]
    # fitting method   = leastsq
    # function evals   = 63
    # data points      = 55
    # variables        = 1
    chi-square         = 6.2914e-04
    reduced chi-square = 1.1651e-05
    Akaike info crit   = -623.817334
    Bayesian info crit = -621.810001
    R-squared          = 0.92325646
[[Variables]]
    k1:  1.3759e-04 +/- 8.2637e-06 (6.01%) (init = 0.02)
For pH 0.28, log(k_obs) = -3.861+/-0.026
</pre></div>
</div>
<img alt="../_images/e5c2789b4015bec062dcdf0586a64d04e7414b85f3a23e627413b23072ffc5f5.png" src="../_images/e5c2789b4015bec062dcdf0586a64d04e7414b85f3a23e627413b23072ffc5f5.png" />
</div>
</div>
</section>
<section id="curve-fitting-the-model">
<h2>Curve Fitting the Model<a class="headerlink" href="#curve-fitting-the-model" title="Permalink to this heading">#</a></h2>
<p>let us use the equation derived for the reaction scheme as presented in the paper. Note: This is the correct equation, not the erroneous one presented in the paper. We will also fit the equation presented by the authors later in this document just to watch it blow up.</p>
<p>The code below is almost identical to that above. I changed the functions that represent the model and changed a few other places that used those functions (we have more parameters now). Otherwise its the same: make model, fit model, plot.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Calculating line fit and confidence interval using lmfit methods </span>

<span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>


<span class="c1">### This function is used in the curve fit. the curve fit tools cannot handle ufloat values    </span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>

    <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
    <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
    
    <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
    <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">At</span><span class="o">*</span><span class="n">eA</span> <span class="o">+</span> <span class="n">eI</span><span class="o">*</span><span class="n">It</span> <span class="o">+</span> <span class="n">eP</span><span class="o">*</span><span class="n">Pt</span>     

    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      

<span class="n">pH</span> <span class="o">=</span> <span class="n">pH_values</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span>      <span class="c1"># time in seconds</span>

<span class="c1">##########################</span>
<span class="c1">### use lmfit to fit data to function </span>
<span class="c1">##########################</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s1">&#39;omit&#39;</span><span class="p">)</span>  <span class="c1"># load the function f as the model to be fit</span>

                                    <span class="c1"># state the parameters (use the text strings that we used above in sympy)</span>
<span class="n">pars</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">k1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.00001</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">k2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">))</span>    <span class="c1"># initial values are also set here</span>
                                    
<span class="n">result</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Use the .fit method on the model object to perform the curve fit</span>
                                <span class="c1"># the variable in this function is &#39;t&#39; so we must use that in the call</span>
<span class="c1">##########################</span>
<span class="c1">### get the results </span>
<span class="c1">##########################</span>

<span class="c1">#   print(result.fit_report())</span>

<span class="n">k1_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span>
<span class="n">k2_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k2&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pH = </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">, log(k1) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k1_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">, log(k2) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k2_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1">###############################################################################</span>
<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          teitle = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance$ &quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /s$&quot;</span><span class="p">,</span>                
<span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.25</span><span class="p">]</span>
       <span class="p">)</span>

<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 

<span class="c1"># Plot the curve fit line</span>

<span class="n">bestfit_y1</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">x1</span><span class="p">)</span>
<span class="n">devs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval_uncertainty</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">bestfit_y1</span><span class="p">,</span> 
           <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>


<span class="c1">######################</span>
<span class="c1">#### Create Confidence band upper and lower bounds</span>
<span class="c1">######################</span>

<span class="c1"># upper and lower bounds of uncertain kobs as float values</span>
<span class="n">fit_up</span> <span class="o">=</span> <span class="n">bestfit_y1</span> <span class="o">+</span> <span class="n">devs</span>
<span class="n">fit_dn</span> <span class="o">=</span> <span class="n">bestfit_y1</span> <span class="o">-</span> <span class="n">devs</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">fit_up</span><span class="p">,</span> <span class="n">fit_dn</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>



<span class="c1">######################</span>
<span class="c1">### Plot the residuals</span>
<span class="c1">######################</span>

<span class="c1"># difference between data and line-fit</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">residual</span>      

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          title = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Residuals&quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="p">,</span>                
<span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.007</span><span class="p">,</span><span class="o">+</span><span class="mf">0.007</span><span class="p">]</span>
       <span class="p">)</span>
<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">devs</span><span class="p">,</span> <span class="o">-</span><span class="n">devs</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>

<span class="c1">######################</span>
<span class="c1">### Other elements - add components</span>
<span class="c1">######################</span>

<span class="k">def</span> <span class="nf">components</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>

    <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
    <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
    
    <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
    <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">Abs_A</span> <span class="o">=</span> <span class="n">At</span> <span class="o">*</span> <span class="n">eA</span> 
    <span class="n">Abs_I</span> <span class="o">=</span> <span class="n">eI</span> <span class="o">*</span> <span class="n">It</span>    
    <span class="n">Abs_P</span> <span class="o">=</span> <span class="n">eP</span> <span class="o">*</span> <span class="n">Pt</span>  

    <span class="k">return</span><span class="p">(</span><span class="n">Abs_A</span><span class="p">,</span> <span class="n">Abs_I</span><span class="p">,</span> <span class="n">Abs_P</span><span class="p">)</span>   

<span class="c1"># calculate Abs contributions for A,I and P using the curve fit parameters</span>
<span class="p">[</span><span class="n">Abs_A</span><span class="p">,</span> <span class="n">Abs_I</span><span class="p">,</span> <span class="n">Abs_P</span><span class="p">]</span> <span class="o">=</span> <span class="n">components</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">k1_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

<span class="c1"># Plot the calculated contributions from each component</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">Abs_A</span><span class="p">,</span> 
           <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> 
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">Abs_I</span><span class="p">,</span> 
           <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> 
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">Abs_P</span><span class="p">,</span> 
           <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> 
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1">### Output plot</span>
<span class="c1">#plt.tight_layout(pad=2, h_pad=None, w_pad=None, rect=None)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/05B_Kirby2_CorrectModel_lmfit.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pH = 6.50, log(k1) = -4.608+/-0.005, log(k2) = -4.138+/-0.005
</pre></div>
</div>
<img alt="../_images/431d01dbea14ab10ea82e29a3718269b1a12aa07e2d68208b3f554b5fe494b3c.png" src="../_images/431d01dbea14ab10ea82e29a3718269b1a12aa07e2d68208b3f554b5fe494b3c.png" />
</div>
</div>
</section>
<section id="the-same-thing-again-again">
<h2>The Same Thing Again &amp; Again<a class="headerlink" href="#the-same-thing-again-again" title="Permalink to this heading">#</a></h2>
<p>The code above performed a curve fit according the the model givem reported the best fit parameters found and then plotted the data and the calculated lined based on the best-fit parameters. But, it only does a single selected set of data at a time.</p>
<p>The code below is identical (almost). I have put it in a loop so that we can iterate through all the columns in the data. The best-fit parameters for <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span> will be collected in lists and then written out as a csv file for further analysis.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">lmfit</span>     
<span class="kn">import</span> <span class="nn">uncertainties</span> <span class="k">as</span> <span class="nn">un</span>               <span class="c1"># tool set for handling uncertainties</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="kn">import</span> <span class="n">unumpy</span> <span class="k">as</span> <span class="n">unp</span>  <span class="c1"># a replacement for numpy </span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1">### This function is used in the curve fit. the curve fit tools cannot handle ufloat values    </span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>

    <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
    <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
    
    <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
    <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">At</span><span class="o">*</span><span class="n">eA</span> <span class="o">+</span> <span class="n">eI</span><span class="o">*</span><span class="n">It</span> <span class="o">+</span> <span class="n">eP</span><span class="o">*</span><span class="n">Pt</span>     

    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      

<span class="c1">### This function is the same as used in the curve fit. It uses ufloat values and it is used</span>
<span class="c1">### when we calculate the line fit and include uncertainties for the confidence interval.    </span>
<span class="k">def</span> <span class="nf">f_u</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>

    <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
    <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
    
    <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
    <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">At</span><span class="o">*</span><span class="n">eA</span> <span class="o">+</span> <span class="n">eI</span> <span class="o">*</span> <span class="n">It</span> <span class="o">+</span> <span class="n">eP</span> <span class="o">*</span> <span class="n">Pt</span>     

    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      

<span class="n">pH_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">k1_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">k1_list_stdev</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">k2_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">k2_list_stdev</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span>      <span class="c1"># time in seconds</span>
    
<span class="k">for</span> <span class="n">pH</span> <span class="ow">in</span> <span class="n">pH_values</span><span class="p">:</span>     <span class="c1"># choose one of the pH columns</span>
    
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>
    <span class="n">pH_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pH</span><span class="p">)</span>

    <span class="c1">##########################</span>
    <span class="c1">### use lmfit to fit data to function </span>
    <span class="c1">##########################</span>
    
    <span class="n">mod</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s1">&#39;omit&#39;</span><span class="p">)</span>  <span class="c1"># load the function f as the model to be fit</span>
    
                                        <span class="c1"># state the parameters (use the text strings that we used above in sympy)</span>
    <span class="n">pars</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">k1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                           <span class="n">k2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.00001</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">))</span>    <span class="c1"># initial values are also set here</span>
                                        
    <span class="n">result</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Use the .fit method on the model object to perform the curve fit</span>
                                    <span class="c1"># the variable in this function is &#39;t&#39; so we must use that in the call</span>
    <span class="c1">##########################</span>
    <span class="c1">### get the results </span>
    <span class="c1">##########################</span>
    
<span class="c1">#    print(result.fit_report())</span>
    
    <span class="n">k1_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span>
    <span class="n">k2_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k2&#39;</span><span class="p">]</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pH = </span><span class="si">{</span><span class="n">pH_value</span><span class="si">}</span><span class="s2">, log(k1) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k1_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">, log(k2) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k2_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">bestfit_y1</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">x1</span><span class="p">)</span>   <span class="c1"># uncertain values - used for confidence interval</span>
    <span class="n">devs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">eval_uncertainty</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
        
    <span class="c1">###############################################################################</span>
    <span class="c1">######################</span>
    <span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
    <span class="c1">######################</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  
    
    <span class="c1"># Settings for plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="c1">#          teitle = Title,       </span>
              <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance$ &quot;</span><span class="p">,</span> 
              <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /s$&quot;</span><span class="p">,</span>                
    <span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
              <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.65</span><span class="p">]</span>
           <span class="p">)</span>
    
    <span class="c1">### Data graphics</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                  <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
                  <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 
    
    <span class="c1"># Plot the curve fit line</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">),</span> 
               <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
               <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    
    <span class="c1">######################</span>
    <span class="c1">#### Create Confidence band upper and lower bounds</span>
    <span class="c1">######################</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>
    
    <span class="c1"># upper and lower bounds of uncertain kobs as float values</span>
    <span class="n">fit_up</span> <span class="o">=</span> <span class="n">bestfit_y1</span> <span class="o">+</span> <span class="n">devs</span>
    <span class="n">fit_dn</span> <span class="o">=</span> <span class="n">bestfit_y1</span> <span class="o">-</span> <span class="n">devs</span>
    
    <span class="c1"># make filled band</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">fit_up</span><span class="p">,</span> <span class="n">fit_dn</span><span class="p">,</span> 
                       <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>
    
    <span class="c1">######################</span>
    <span class="c1">#### Add to the Lists</span>
    <span class="c1">######################</span>

    <span class="n">pH_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pH_value</span><span class="p">)</span> 
    <span class="n">k1_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k1_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
    <span class="n">k1_list_stdev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k1_fit</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
    <span class="n">k2_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
    <span class="n">k2_list_stdev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k2_fit</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>

    <span class="c1">######################</span>
    <span class="c1">### Plot the residuals</span>
    <span class="c1">######################</span>
    
    <span class="c1"># difference between data and line-fit</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">residual</span>      
    
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="c1">#          title = Title,       </span>
              <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Residuals&quot;</span><span class="p">,</span> 
              <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="p">,</span>                
    <span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.007</span><span class="p">,</span><span class="o">+</span><span class="mf">0.007</span><span class="p">]</span>
           <span class="p">)</span>
    <span class="c1">### Data graphics</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                  <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
                  <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
    
    <span class="c1"># make filled band</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">devs</span><span class="p">,</span> <span class="o">-</span><span class="n">devs</span><span class="p">,</span> 
                       <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                       <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    
    <span class="c1">######################</span>
    <span class="c1">### Other elements - add components</span>
    <span class="c1">######################</span>
    
    <span class="k">def</span> <span class="nf">components</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
    
        <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1">### extinction coefficients (ratios)</span>
        <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.3</span>
        <span class="n">eP</span> <span class="o">=</span> <span class="mf">0.6</span>
        <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.2</span>     <span class="c1">### Initial absorbance</span>
        
        <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
        <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
        <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
        <span class="n">Abs_A</span> <span class="o">=</span> <span class="n">At</span> <span class="o">*</span> <span class="n">eA</span> 
        <span class="n">Abs_I</span> <span class="o">=</span> <span class="n">eI</span> <span class="o">*</span> <span class="n">It</span>    
        <span class="n">Abs_P</span> <span class="o">=</span> <span class="n">eP</span> <span class="o">*</span> <span class="n">Pt</span>  
    
        <span class="k">return</span><span class="p">(</span><span class="n">Abs_A</span><span class="p">,</span> <span class="n">Abs_I</span><span class="p">,</span> <span class="n">Abs_P</span><span class="p">)</span>   
    
    <span class="c1"># calculate Abs contributions for A,I and P using the curve fit parameters</span>
    <span class="p">[</span><span class="n">Abs_A</span><span class="p">,</span> <span class="n">Abs_I</span><span class="p">,</span> <span class="n">Abs_P</span><span class="p">]</span> <span class="o">=</span> <span class="n">components</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">k1_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
    
    <span class="c1"># Plot the calculated contributions from each component</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">Abs_A</span><span class="p">,</span> 
               <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> 
               <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">Abs_I</span><span class="p">,</span> 
               <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> 
               <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">Abs_P</span><span class="p">,</span> 
               <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> 
               <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.65</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;pH = </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1">### Output plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/fits/05B_Kirby2_CorrectModel_pH_&quot;</span><span class="o">+</span><span class="n">pH</span><span class="o">+</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">df_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;pH&quot;</span><span class="p">:</span> <span class="n">pH_list</span><span class="p">,</span>
                       <span class="s2">&quot;k1 value&quot;</span><span class="p">:</span> <span class="n">k1_list</span><span class="p">,</span>
                       <span class="s2">&quot;k1 stdev&quot;</span><span class="p">:</span> <span class="n">k1_list_stdev</span><span class="p">,</span>
                       <span class="s2">&quot;k2 value&quot;</span><span class="p">:</span> <span class="n">k2_list</span><span class="p">,</span>
                       <span class="s2">&quot;k2 stdev&quot;</span><span class="p">:</span> <span class="n">k2_list_stdev</span>
                       <span class="p">})</span>

<span class="n">df_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;results.csv&quot;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pH = 0.0, log(k1) = -2.961+/-0.023, log(k2) = -3.182+/-0.011
pH = 0.28, log(k1) = -3.309+/-0.011, log(k2) = -3.535+/-0.005
pH = 0.55, log(k1) = -3.628+/-0.008, log(k2) = -3.8880+/-0.0034
pH = 1.0, log(k1) = -3.873+/-0.007, log(k2) = -4.2124+/-0.0028
pH = 1.25, log(k1) = -4.164+/-0.004, log(k2) = -4.4735+/-0.0018
pH = 1.5, log(k1) = -4.169+/-0.004, log(k2) = -4.7933+/-0.0013
pH = 1.9, log(k1) = -4.1719+/-0.0035, log(k2) = -5.0936+/-0.0019
pH = 2.25, log(k1) = -4.0821+/-0.0028, log(k2) = -5.2757+/-0.0020
pH = 2.6, log(k1) = -3.8898+/-0.0032, log(k2) = -5.3293+/-0.0021
pH = 3.4, log(k1) = -3.484+/-0.005, log(k2) = -5.4133+/-0.0024
pH = 3.7, log(k1) = -3.253+/-0.006, log(k2) = -5.4431+/-0.0023
pH = 4.1, log(k1) = -3.110+/-0.008, log(k2) = -5.4590+/-0.0025
pH = 4.4, log(k1) = -3.077+/-0.007, log(k2) = -5.3941+/-0.0019
pH = 4.75, log(k1) = -3.176+/-0.007, log(k2) = -5.2207+/-0.0016
pH = 5.1, log(k1) = -3.409+/-0.006, log(k2) = -5.2243+/-0.0017
pH = 5.6, log(k1) = -3.759+/-0.005, log(k2) = -4.9455+/-0.0013
pH = 6.0, log(k1) = -4.070+/-0.005, log(k2) = -4.5495+/-0.0016
pH = 6.5, log(k1) = -4.608+/-0.005, log(k2) = -4.138+/-0.005
pH = 6.9, log(k1) = -5.014+/-0.005, log(k2) = -3.775+/-0.013
</pre></div>
</div>
</div>
</div>
<section id="the-ph-rate-profile">
<h3>The pH-rate profile<a class="headerlink" href="#the-ph-rate-profile" title="Permalink to this heading">#</a></h3>
<p>We now have best-fit parameters for <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span>. We can now plot these values against pH to visualize a pH-rate profile for each reaction.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;results.csv&quot;</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>

<span class="c1">#display(df3.head())</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[</span><span class="s2">&quot;pH&quot;</span><span class="p">]</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">df3</span><span class="p">[</span><span class="s2">&quot;k1 value&quot;</span><span class="p">],</span><span class="n">df3</span><span class="p">[</span><span class="s2">&quot;k1 stdev&quot;</span><span class="p">])</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">df3</span><span class="p">[</span><span class="s2">&quot;k2 value&quot;</span><span class="p">],</span><span class="n">df3</span><span class="p">[</span><span class="s2">&quot;k2 stdev&quot;</span><span class="p">])</span>

<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>

<span class="n">y1n</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">y2n</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
<span class="n">y1s</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">y2s</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\log{(k_1\ /s^{-1})}$ &quot;</span><span class="p">,</span> 
       <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$pH$&quot;</span><span class="p">,</span>                
       <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">7.1</span><span class="p">],</span>                  
<span class="c1">#       ylim=[-0.03,0.65]</span>
       <span class="p">)</span>

<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1n</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y2n</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1n</span><span class="p">,</span> <span class="n">y1s</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">elinewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y2n</span><span class="p">,</span> <span class="n">y2s</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">elinewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1">### Output plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/05B_Kirby2_k1_k2.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/a35a35f4798dbf38f04c60ad8b1176f4e65f700184e67406d61890bf9efbf193.png" src="../_images/a35a35f4798dbf38f04c60ad8b1176f4e65f700184e67406d61890bf9efbf193.png" />
</div>
</div>
</section>
<section id="examine-your-results">
<h3>Examine Your Results<a class="headerlink" href="#examine-your-results" title="Permalink to this heading">#</a></h3>
<p>NOTE This was for when…</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    eA = 1         ### extinction coefficients (ratios)
    eI = 0.6
    eP = 3
    Abs_0 = 0.1     ### Initial absorbance
</pre></div>
</div>
<p>…when we created the data. The extinction coefficients have been chageed to better fit the results decribed in the paper and now the line fits work with the same initial values in all cases.</p>
<p>We see that there is a classic pH-rate profile for acid and base catalysis. But the results at higher pH (pH 6.5 and 6.9 have much higher errors that the other line fits (errors shown at <span class="math notranslate nohighlight">\(10 \times\)</span> standard deviation so that the difference is obvious). All the points have very small errors. Fitting 50 data points will give small standard deviations, but that doesn’t mean your answer is correct.</p>
<p>The residuals look good for all plots except the highest pH. In this last plot, the line fit looks good, the standard deviation is small (but is 100X greater than in most other fits in the series) however the resisual plot reveals a definite pattern. The residual plots in all other fits is nice and random, but not in the case of the highest pH point.</p>
<p>In the plot above you can see that <span class="math notranslate nohighlight">\(k_1\)</span> is faster that <span class="math notranslate nohighlight">\(k_2\)</span> in all experiments except the two highest pH points. Our initial conditions for the line fits started with <span class="math notranslate nohighlight">\(k_1 &gt; k_2\)</span>. The line fit may have failed because of a poor starting position in the line fit. We could address this by setting tighter conditions for convergence but if we are already on a wrong path that may not help.</p>
<p>One simple solution is to begin from a different starting point. If I select a set of starting conditions where <span class="math notranslate nohighlight">\(k_1 &lt; k_2\)</span> then we may converge to the correct solution. Return to the code block above that ran a single curve fit. Excgane the initial values for <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span> and examine the resulting plot.</p>
</section>
<section id="change-the-results">
<h3>Change the Results<a class="headerlink" href="#change-the-results" title="Permalink to this heading">#</a></h3>
<p>You will have seen that if we performed the curve fit starting with <span class="math notranslate nohighlight">\(k_1 &lt; k_2\)</span> we observed a much better residual plot and tigher standard deviation for the highest pH experiment. This is the best fit. There sometimes is not a single starting point for fitting a mathematical model across a wide range of conditions. Here we see such a case.</p>
<p>I ran the curve fit with the new starting conditions and recorded the following results for pH 6.5 and 6.9:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>pH</p></th>
<th class="head text-left"><p>Previous <span class="math notranslate nohighlight">\(\log{k_1}\)</span></p></th>
<th class="head text-left"><p>Previous <span class="math notranslate nohighlight">\(\log{k_2}\)</span></p></th>
<th class="head text-left"><p>New <span class="math notranslate nohighlight">\(\log{k_1}\)</span></p></th>
<th class="head text-left"><p>New <span class="math notranslate nohighlight">\(\log{k_2}\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>6.5</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(-4.609\pm 0.006\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(-4.140\pm 0.027\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(-4.609\pm 0.006\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(-4.140\pm 0.027\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>6.9</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(-4.861\pm 0.008\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(-4.622\pm 0.034\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(-5.0175\pm 0.0024\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(-3.783\pm 0.023\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<p>We see that we have the same result for the pH 6.5 experiment. Both starting conditions led to the same place. However, for the pH 6.9 experiment we see that the best fit values are very different and the errors are much less. Also the residual plot shows a random pattern. This is the best fit.</p>
<p>The error for <span class="math notranslate nohighlight">\(k_2\)</span> is high compared to the errors for <span class="math notranslate nohighlight">\(k_2\)</span> in other experiments in the series because, when <span class="math notranslate nohighlight">\(k_1 &lt; k_2\)</span>, the rate of absorbance change is controlled by the r.d.s. <span class="math notranslate nohighlight">\(k_1\)</span>. There is little information in the data to separate the two contributions. We should run this experiment for a longer time to get more data if we want smaller statistical deviations.</p>
<p>Examine the correlation between <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span> as revealed in the lmfit report. It is a <span class="math notranslate nohighlight">\(\% 96\)</span> correlation. When we perform the experiment at pH 4 we see that <span class="math notranslate nohighlight">\(k_1 \gg k_2\)</span> and the two effects play out at entirely different time regions of the abs vs time plot (do the curve fit with the code above and see for yourself). Correlation between the two parameters is too small to detect.</p>
<p>So the final two experiments in the series had difficulty fitting for the <span class="math notranslate nohighlight">\(k_2\)</span> parameter. The standard deviations are much larger than for the other points. Examination of the residual plot informed me which set of parameters gave the better fit and the results do make more sense when included in the pH rate profile. Remember, you can drop a point just because it looks bad on your graph. here we used math to find a route to a btter curve fit.</p>
<p>Because all of this is contained in this notebook anyone following my work can see my reasoning, repeat the calculations, try entirely different starting conditions for the line fit and eventually satisfy themselves that I am correct.</p>
<p>Kirby’s paper gives a fair amount of space to discussing the line fit for the mathematical model of the pH rate profile. Nowhere is it mentioned that the <span class="math notranslate nohighlight">\(k_2\)</span> values for the two highest pH experiments are much less confident that the other values. When we apply our own curve fit to the pH rate profiles for <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span> we will include the standard deviation in the fit and that will reduce the weight of these last two experiments in the fiting algorithm. We will very likely get slightly different numbers than the authors. We are only guessing as to the curve fit methods used by the authors, but readers of this series of notebooks will know exactly what we did and will be able to repeat our analysis exactly.</p>
<p>Will you include the code for all your data analysis in the supplemental material for papers you submit to journals? I hope that you will. Interactive notebooks like this provide a standard way to present you code and your arguments together.</p>
</section>
</section>
<section id="the-best-fit">
<h2>The Best Fit<a class="headerlink" href="#the-best-fit" title="Permalink to this heading">#</a></h2>
<p>I will take the csv file generated previously and change the data in the last line to correspond to the best fit for that experiment as discussed above. Below is the best pH-rate profile for both <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span>.</p>
<p>Note: Again us use <span class="math notranslate nohighlight">\(10 \times\)</span> the standard deviation for the error bars so that the relative magnitude of the errors is evident. We see that the standard deviations for most points is tiny compared to that for the final two <span class="math notranslate nohighlight">\(k_2\)</span> values.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pH6_9_log_k1</span> <span class="o">=</span> <span class="n">un</span><span class="o">.</span><span class="n">ufloat_fromstr</span><span class="p">(</span><span class="s2">&quot;-5.0175+/-0.0024&quot;</span><span class="p">)</span>
<span class="n">pH6_9_log_k2</span> <span class="o">=</span> <span class="n">un</span><span class="o">.</span><span class="n">ufloat_fromstr</span><span class="p">(</span><span class="s2">&quot;-3.783+/-0.023&quot;</span><span class="p">)</span>

<span class="n">df3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;results.csv&quot;</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[</span><span class="s2">&quot;pH&quot;</span><span class="p">]</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">df3</span><span class="p">[</span><span class="s2">&quot;k1 value&quot;</span><span class="p">],</span><span class="n">df3</span><span class="p">[</span><span class="s2">&quot;k1 stdev&quot;</span><span class="p">])</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">df3</span><span class="p">[</span><span class="s2">&quot;k2 value&quot;</span><span class="p">],</span><span class="n">df3</span><span class="p">[</span><span class="s2">&quot;k2 stdev&quot;</span><span class="p">])</span>

<span class="n">y1</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>

<span class="n">y1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pH6_9_log_k1</span>
<span class="n">y2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pH6_9_log_k2</span>


<span class="n">y1n</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">y2n</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
<span class="n">y1s</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">y2s</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">github_styles_location</span> <span class="o">+</span> <span class="s2">&quot;tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\log{(k_1\ /s^{-1})}$ &quot;</span><span class="p">,</span> 
       <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$pH$&quot;</span><span class="p">,</span>                
       <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">7.1</span><span class="p">],</span>                  
<span class="c1">#       ylim=[-0.03,0.65]</span>
       <span class="p">)</span>

<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1n</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y2n</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1n</span><span class="p">,</span> <span class="n">y1s</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">elinewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y2n</span><span class="p">,</span> <span class="n">y2s</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">elinewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1">### Output plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/05B_Kirby2_k1_k2_betterfit.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">### Save the new altered dataframe to a csv file</span>

<span class="n">df_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;pH&quot;</span><span class="p">:</span> <span class="n">pH_list</span><span class="p">,</span>
                       <span class="s2">&quot;log_k1 value&quot;</span><span class="p">:</span> <span class="n">y1n</span><span class="p">,</span>
                       <span class="s2">&quot;log_k1 stdev&quot;</span><span class="p">:</span> <span class="n">y1s</span><span class="p">,</span>
                       <span class="s2">&quot;log_k2 value&quot;</span><span class="p">:</span> <span class="n">y2n</span><span class="p">,</span>
                       <span class="s2">&quot;log_k2 stdev&quot;</span><span class="p">:</span> <span class="n">y2s</span>
                       <span class="p">})</span>

<span class="n">df_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;results2.csv&quot;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/badb23931868c12025978c871ce1c743542fe918c65c81480c3381e828320a2f.png" src="../_images/badb23931868c12025978c871ce1c743542fe918c65c81480c3381e828320a2f.png" />
</div>
</div>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">#</a></h2>
<p>We now have determined best fit parameters for all the kinetic experiments and plotted them in the pH-rate profile above. Along the way we learned to check the line fits visually by using residual plots. We observed that line fits can be influenced by initial conditions.</p>
<p>In the next notebook we will fit the pH-rate profile to a model for acid-base catalysis.</p>
</section>
<section id="extra-the-wrong-equation">
<h2>Extra: The Wrong Equation<a class="headerlink" href="#extra-the-wrong-equation" title="Permalink to this heading">#</a></h2>
<p>The equation 3 in the paper has two typographical errors. If we were to use it for a curve fit we get nonsense results. Consider the code below that uses the incorrect equation as is.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">lmfit</span>     
<span class="kn">import</span> <span class="nn">uncertainties</span> <span class="k">as</span> <span class="nn">un</span>               <span class="c1"># tool set for handling uncertainties</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="kn">import</span> <span class="n">unumpy</span> <span class="k">as</span> <span class="n">unp</span>  <span class="c1"># a replacement for numpy </span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="n">pH</span> <span class="o">=</span> <span class="n">pH_values</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span>     <span class="c1"># choose one of the pH columns</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pH is </span><span class="si">{</span><span class="n">pH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fit_u</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>  <span class="c1"># wrong equation</span>

    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span> <span class="n">eP</span> <span class="o">=</span> <span class="mi">3</span>
    
    <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
    <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">At</span><span class="o">*</span><span class="n">eA</span> <span class="o">+</span> <span class="n">eI</span> <span class="o">*</span> <span class="n">It</span> <span class="o">+</span> <span class="n">eP</span> <span class="o">*</span> <span class="n">Pt</span>     

    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      
    
<span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>

    <span class="n">Abs_0</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="n">eA</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">eI</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span> <span class="n">eP</span> <span class="o">=</span> <span class="mi">3</span>
    
    <span class="n">A0</span> <span class="o">=</span> <span class="n">Abs_0</span> <span class="o">/</span> <span class="n">eA</span>
    <span class="n">At</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">It</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">k1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">Pt</span> <span class="o">=</span> <span class="n">A0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">Total_Abs</span> <span class="o">=</span> <span class="n">At</span><span class="o">*</span><span class="n">eA</span> <span class="o">+</span> <span class="n">eI</span><span class="o">*</span><span class="n">It</span> <span class="o">+</span> <span class="n">eP</span><span class="o">*</span><span class="n">Pt</span>     

    <span class="k">return</span><span class="p">(</span><span class="n">Total_Abs</span><span class="p">)</span>      

<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span>      <span class="c1"># time in seconds</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pH</span><span class="p">]</span>

<span class="c1">##########################</span>
<span class="c1">### use lmfit to fit data to function </span>
<span class="c1">##########################</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s1">&#39;omit&#39;</span><span class="p">)</span>                  <span class="c1"># load the function f as the model to be fit</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;parameter names: </span><span class="si">{</span><span class="n">mod</span><span class="o">.</span><span class="n">param_names</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;independent variables: </span><span class="si">{</span><span class="n">mod</span><span class="o">.</span><span class="n">independent_vars</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                                    <span class="c1"># state the parameters (use the text strings that we used above in sympy)</span>
<span class="n">pars</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">k1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">),</span>
                       <span class="n">k2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.0002</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mf">1E-15</span><span class="p">))</span>    <span class="c1"># initial values are also set here</span>
                                    
<span class="n">result</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>          <span class="c1"># use the .fit method on the model object to perform the curve fit</span>
                                        <span class="c1"># the variable in this function is &#39;t&#39; so we must use that in the call</span>
<span class="c1">##########################</span>
<span class="c1">### get the results </span>
<span class="c1">##########################</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fit_report</span><span class="p">())</span>

<span class="n">k1_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span>
<span class="n">k2_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uvars</span><span class="p">[</span><span class="s1">&#39;k2&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log(k1) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k1_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log(k2) = </span><span class="si">{</span><span class="n">unp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k2_fit</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">bestfit_y1</span> <span class="o">=</span> <span class="n">fit_u</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">k1_fit</span><span class="p">,</span> <span class="n">k2_fit</span><span class="p">)</span>

<span class="c1">###############################################################################</span>
<span class="c1">######################</span>
<span class="c1">### Plots - NEW STYLED PLOTTING SECTION from 03B-Eyring_Exercises_2_curvefit.ipynb</span>
<span class="c1">######################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;../styles/tufte.mplstyle&quot;</span><span class="p">)</span>     <span class="c1">### Then add a fancy style sheet   </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  

<span class="c1"># Settings for plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          teitle = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm absorbance$ &quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rm time\ /s$&quot;</span><span class="p">,</span>                
<span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.65</span><span class="p">]</span>
       <span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> 

<span class="c1"># Plot the curve fit line</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">),</span> 
           <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>


<span class="c1">######################</span>
<span class="c1">#### Create Confidence band upper and lower bounds</span>
<span class="c1">######################</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># upper and lower bounds of uncertain kobs as float values</span>
<span class="n">fit_up</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">+</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span>
<span class="n">fit_dn</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">-</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">fit_up</span><span class="p">,</span> <span class="n">fit_dn</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="c1">######################</span>
<span class="c1">### Plot the residuals</span>
<span class="c1">######################</span>

<span class="c1"># difference between data and line-fit</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k1_fit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">k2_fit</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>      

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<span class="c1">#          title = Title,       </span>
          <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Residuals&quot;</span><span class="p">,</span> 
          <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="p">,</span>                
<span class="c1">#          xlim=[0, np.max(x) + np.max(x) * 0.1],                  </span>
          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">]</span>
       <span class="p">)</span>
<span class="c1">### Data graphics</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> 
              <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># make filled band</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="o">-</span><span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">bestfit_y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> 
                   <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;confidence interval&quot;</span><span class="p">)</span>

<span class="c1">### Other elements</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>


<span class="c1">### Output plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/05C_Kirby2_wrongEq.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pH is 5.60
parameter names: [&#39;k1&#39;, &#39;k2&#39;]
independent variables: [&#39;t&#39;]
[[Model]]
    Model(fit)
[[Fit Statistics]]
    # fitting method   = leastsq
    # function evals   = 40
    # data points      = 55
    # variables        = 2
    chi-square         = 0.04031617
    reduced chi-square = 7.6068e-04
    Akaike info crit   = -393.008476
    Bayesian info crit = -388.993809
    R-squared          = -27.3750121
[[Variables]]
    k1:  0.63291060 +/- 0.01025997 (1.62%) (init = 0.002)
    k2:  7.4595e-07 +/- 6.5836e-07 (88.26%) (init = 0.0002)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(k1, k2) = -0.8675
log(k1) = -0.199+/-0.007
log(k2) = -6.1+/-0.4
</pre></div>
</div>
<img alt="../_images/6639aa7880f35bc9e8d49475c356b4d38c0f2d9a088716b6c0aa2303feeca47b.png" src="../_images/6639aa7880f35bc9e8d49475c356b4d38c0f2d9a088716b6c0aa2303feeca47b.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Class_11"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2-part-5-ph-rate-profile-example-kirby-2002">Example 2, Part 5: pH-Rate Profile Example - Kirby 2002</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-equations">The equations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-data">Plot the Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#many-plots">Many Plots</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#curve-fit-to-1st-order">Curve Fit to 1st Order</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#curve-fitting-the-model">Curve Fitting the Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-same-thing-again-again">The Same Thing Again &amp; Again</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-ph-rate-profile">The pH-rate profile</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-your-results">Examine Your Results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#change-the-results">Change the Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-best-fit">The Best Fit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-the-wrong-equation">Extra: The Wrong Equation</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Barry Linkletter
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>